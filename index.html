<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
   <meta charset="UTF-8">
   <meta name="viewport" content="width=device-width, initial-scale=1.0">
   <title>Gilat AI - ×—×™×¤×•×© ×‘××"×</title>
   <link href="https://fonts.googleapis.com/css2?family=Heebo:wght@300;400;700&display=swap" rel="stylesheet">
   <style>
       :root {
           --primary-color: #0056b3;
           --bg-color: #f4f7f6;
           --container-bg: #ffffff;
       }

       body {
           font-family: 'Heebo', sans-serif;
           background-color: var(--bg-color);
           color: #333;
           margin: 0;
           padding: 20px;
           display: flex;
           justify-content: center;
       }

       .container {
           width: 100%;
           max-width: 900px;
           background-color: var(--container-bg);
           padding: 30px;
           border-radius: 12px;
           box-shadow: 0 4px 15px rgba(0,0,0,0.1);
       }

       h2 { color: var(--primary-color); text-align: center; margin-top: 0; }

       label { font-weight: bold; margin-top: 20px; display: block; margin-bottom: 5px; }

       input[type="text"] {
           width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 8px;
           box-sizing: border-box; font-size: 16px;
           text-align: right;
       }

       button {
           width: 100%; padding: 12px; background-color: var(--primary-color);
           color: white; border: none; border-radius: 8px; font-size: 18px;
           cursor: pointer; margin-top: 15px; transition: background 0.3s;
       }
       button:hover { background-color: #004494; }
       button:disabled { background-color: #ccc; cursor: not-allowed; }

       /* ×ª×•×¦××•×ª */
       #results-area { margin-top: 30px; border-top: 1px solid #eee; padding-top: 20px; }

       /* ×ª×™×‘×ª ×”×¡×™×›×•× */
       .summary-box {
           background-color: #f0f8ff;
           border: 1px solid #cce5ff;
           padding: 15px;
           border-radius: 8px;
           line-height: 1.8;
           font-size: 1.05em;
           color: #000;
           white-space: pre-wrap;
           text-align: right;
           direction: rtl;
       }

       /* ×¦×™×˜×•×˜×™× [1] */
       .citation-link {
           color: var(--primary-color);
           font-weight: bold;
           text-decoration: none;
           background-color: #e6f2ff;
           padding: 0 4px;
           border-radius: 4px;
           margin: 0 2px;
           cursor: pointer;
       }

       /* ×›×¨×˜×™×¡×™×™×ª ×ª×•×¦××” */
       .search-result {
           background: #fff; border: 1px solid #e1e4e8; border-right: 4px solid var(--primary-color);
           padding: 15px; margin-bottom: 15px; border-radius: 6px; box-shadow: 0 2px 5px rgba(0,0,0,0.05);
           transition: background-color 0.3s;

           /* ×ª×™×§×•×Ÿ ×§×¨×™×˜×™ ×œ×™×™×©×•×¨ */
           text-align: right;
           direction: rtl;
       }

       .highlight-result { animation: flash-bg 1.5s ease-out; }
       @keyframes flash-bg { 0% { background-color: #fff9c4; } 100% { background-color: #fff; } }

       /* ×ª×™×§×•×Ÿ ×œ×›×•×ª×¨×ª ×”××¡××š ×‘×ª×•×¦××•×ª */
       .result-header {
           display: flex;
           align-items: flex-start; /* ×™×™×©×•×¨ ×œ×—×œ×§ ×”×¢×œ×™×•×Ÿ */
           gap: 10px;
           margin-bottom: 10px;
       }

       .document-title {
           font-weight: bold;
           color: var(--primary-color);
           text-decoration: none;
           font-size: 1.2em;
           display: inline-block;
           direction: rtl; /* ×—×©×•×‘ ×œ×›×•×ª×¨×•×ª ×‘×× ×’×œ×™×ª */
           text-align: right;
       }
       .document-title:hover { text-decoration: underline; }

       .result-number {
           background: #eee;
           padding: 2px 8px;
           border-radius: 4px;
           font-weight:bold;
           font-size:0.9em;
           color: #555;
           flex-shrink: 0; /* ××•× ×¢ ××”××¡×¤×¨ ×œ×”×ª×›×•×•×¥ */
       }

       /* ×ª×™×§×•×Ÿ ×œ×˜×§×¡×˜ ×”××¢×•×¨×‘ */
       .snippet-text {
           margin-top: 10px;
           line-height: 1.6;
           font-size: 0.95em;
           color: #333;

           /* ×–×” ×”×˜×¨×™×§ ×©××¡×“×¨ ×¢×‘×¨×™×ª ×•×× ×’×œ×™×ª ×‘×™×—×“ */
           text-align: right;
           direction: rtl;
           unicode-bidi: embed;
       }

       .metadata-footer {
           font-size: 0.9em;
           color: #555;
           margin-top: 15px;
           border-top: 1px dashed #eee;
           padding-top: 10px;
           display: flex;
           justify-content: space-between; /* ××¤×–×¨ ×œ×¦×“×“×™×: ×ª××¨×™×š ××™××™×Ÿ, ×›×¤×ª×•×¨ ××©×××œ */
           align-items: center;
           flex-wrap: wrap;
           gap: 10px;
       }

       .pdf-btn {
           display: inline-flex;
           align-items: center;
           background-color: #ffebee;
           color: #d32f2f;
           border: 1px solid #ffcdd2;
           padding: 4px 12px;
           border-radius: 4px;
           text-decoration: none;
           font-weight: bold;
           font-size: 0.9em;
           transition: all 0.2s;
       }
       .pdf-btn:hover { background-color: #d32f2f; color: white; border-color: #b71c1c; }
       .pdf-btn svg { width: 18px; height: 18px; margin-left: 6px; fill: currentColor; }

       .loader {
           border: 5px solid #f3f3f3; border-top: 5px solid var(--primary-color);
           border-radius: 50%; width: 40px; height: 40px;
           animation: spin 1s linear infinite; margin: 20px auto; display: none;
       }
       @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
   </style>
</head>
<body>

   <div class="container">
       <h2>ğŸ›ï¸ Gilat AI - ×—×™×¤×•×© ××ª×§×“× ×‘××"×</h2>

       <form onsubmit="sendQuery(); return false;">
           <label for="query">×”×©××™×œ×ª× ×©×œ×š:</label>
           <input type="text" id="query" placeholder="×œ×“×•×’××”: ××” ×”××“×™× ×” ×¢×•×©×” ×›×“×™ ×œ×”×™×•×ª ×‘×—×–×™×ª ×”××™×—×©×•×‘ ×”×§×•×•× ×˜×™" required>
           <button type="submit" id="submitBtn">×—×¤×©</button>
       </form>

       <div id="loader" class="loader"></div>

       <div id="results-area" style="display:none;">
           <h3>âœ¨ ×ª×©×•×‘×ª ×”-AI:</h3>
           <div id="summary-text" class="summary-box"></div>

           <h3>ğŸ“š ××¡××›×™× ×¨×œ×•×•× ×˜×™×™×:</h3>
           <div id="search-results"></div>
       </div>
   </div>

   <script>
       async function sendQuery() {
           const apiKey = "zqt_WQdPgppS5OLumkFHZXSffKRBLzOS1MmAq-c0HA";
           const corpusKey = "mmm_docs5";

           const queryText = document.getElementById("query").value;
           const loader = document.getElementById("loader");
           const resultsArea = document.getElementById("results-area");
           const submitBtn = document.getElementById("submitBtn");
           const summaryDiv = document.getElementById("summary-text");
           const searchResultsDiv = document.getElementById("search-results");

           if (!queryText.trim()) return;

           // UI Reset
           loader.style.display = "block";
           resultsArea.style.display = "none";
           submitBtn.disabled = true;
           submitBtn.innerText = "××¢×‘×“ × ×ª×•× ×™×...";
           summaryDiv.innerHTML = "";
           searchResultsDiv.innerHTML = "";

           const url = "https://api.vectara.io/v2/query";

           const requestData = {
               query: queryText,
               search: {
                   corpora: [{ corpus_key: corpusKey, metadata_filter: "", lexical_interpolation: 0.005, custom_dimensions: {} }],
                   offset: 0,
                   limit: 10,
                   context_configuration: { sentences_before: 2, sentences_after: 2, start_tag: "<b>", end_tag: "</b>" },
                   reranker: { type: "customer_reranker", reranker_id: "rnk_272725719" }
               },
               stream_response: false,
               generation: {
                   generation_preset_name: "vectara-summary-table-md-query-ext-jan-2025-gpt-4o",
                   max_used_search_results: 10,
                   prompt_template: "[\n  {\"role\": \"system\", \"content\": \"You are a search bot that forms a coherent answer to a user query based on search results that are provided to you.\" },\n  {\"role\": \"user\", \"content\": \" [INSTRUCTIONS]\n    Search results may include tables in a markdown format. When answering a question using a table be careful about which rows and columns contain the answer and include all relevant information from the relevant rows and columns that the query is asking about.\n    Do not cobble facts together from multiple search results, instead summarize the main facts into a consistent and easy to understand response.\n    Do not base your response on information or knowledge that is not in the search results.\n    Make sure your response is answering the query asked. If the query is related to an entity (such as a person or place), make sure you use search results related to that entity.\n    For queries where only a short answer is required, you can give a brief response.\n    Consider that each search result is a partial segment from a bigger text, and may be incomplete.\n    Your output should always be in a single language - the $vectaraLangName language. Check spelling and grammar for the $vectaraLangName language.\n    Search results for the query *** $vectaraQuery***, are listed below, some are text, some MAY be tables in the format described above.\n    #foreach ($qResult in $vectaraQueryResultsDeduped)\n      [$esc.java($foreach.index + 1)]\n      #if($qResult.hasTable())\n        Table Title: $qResult.getTable().title() || Table Description: $qResult.getTable().description() || Table Data:\n        $qResult.getTable().markdown()\n      #else\n        $qResult.getText()\n      #end\n    #end\n    Generate a coherent response (but no more than $vectaraOutChars characters) to the query *** $vectaraQuery *** by summarizing the search results provided. Give a slight preference to search results that appear earlier in the list.\n    Only cite relevant search results in your answer following these specific instructions: $vectaraCitationInstructions\n    Respond always in the Hebrew language, and only in that language.\"}\n]",
                   response_language: "heb",
                   model_parameters: { llm_name: "gpt-4o" },
                   enable_factual_consistency_score: true
               },
               save_history: true
           };

           try {
               const response = await fetch(url, {
                   method: "POST",
                   headers: {
                       "Content-Type": "application/json",
                       "Accept": "application/json",
                       "x-api-key": apiKey,
                       "customer-id": "1493651330"
                   },
                   body: JSON.stringify(requestData)
               });

               if (!response.ok) {
                   const errorData = await response.json();
                   throw new Error(JSON.stringify(errorData));
               }

               const data = await response.json();

               // Summary Handling
               if (data.summary) {
                   const processedSummary = data.summary.replace(/\[(\d+)\]/g, (match, number) => {
                       return `<a href="#result-${number}" class="citation-link" onclick="highlightResult(${number})">[${number}]</a>`;
                   });
                   summaryDiv.innerHTML = processedSummary;
               } else {
                   summaryDiv.innerText = "×œ× ×”×ª×§×‘×œ ×¡×™×›×•×.";
               }

               // Search Results Handling
               if (data.search_results && data.search_results.length > 0) {
                   data.search_results.forEach((result, index) => {
                       const resultDiv = document.createElement("div");
                       resultDiv.className = "search-result";
                       const resultNum = index + 1;
                       resultDiv.id = `result-${resultNum}`;

                       // URL logic
                       const rawUrl = result.document_metadata.url || '#';
                       const docUrl = rawUrl.includes('#') ? rawUrl : `${rawUrl}#page=${result.part_metadata.page}`;

                       // Authors
                       let authors = [];
                       if (result.document_metadata.author) authors.push(result.document_metadata.author);
                       if (result.document_metadata.teamleader) authors.push(`×¨"×¦: ${result.document_metadata.teamleader}`);
                       const authorsText = authors.length ? authors.join(', ') : '×œ× ×¦×•×™×Ÿ';

                       const pdfIcon = `<svg viewBox="0 0 24 24"><path d="M20 2H8c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm-8.5 7.5c0 .83-.67 1.5-1.5 1.5H9v2H7.5V7H10c.83 0 1.5.67 1.5 1.5v1zm5 2c0 .83-.67 1.5-1.5 1.5h-2.5V7H15c.83 0 1.5.67 1.5 1.5v3zm4-3H19v1h1.5V11H19v2h-1.5V7h3v1.5zM9 9.5h1v-1H9v1zM4 6H2v14c0 1.1.9 2 2 2h14v-2H4V6zm10 5.5h1v-3h-1v3z"/></svg>`;

                       resultDiv.innerHTML = `
                           <div class="result-header">
                               <span class="result-number">#${resultNum}</span>
                               <a href="${docUrl}" target="_blank" class="document-title">ğŸ“„ ${result.document_metadata.title || '××¡××š ×œ×œ× ×›×•×ª×¨×ª'}</a>
                           </div>

                           <div class="snippet-text">${result.text}</div>

                           <div class="metadata-footer">
                               <div style="flex-grow: 1;">
                                   <strong>×ª××¨×™×š:</strong> ${result.document_metadata.date || '-'} |
                                   <strong>××—×‘×¨×™×:</strong> ${authorsText}
                               </div>
                               <a href="${docUrl}" target="_blank" class="pdf-btn" title="×¤×ª×— ××ª ×”××¡××š ×”××œ×">
                                   ${pdfIcon} ×¤×ª×— ××¡××š
                               </a>
                           </div>
                       `;
                       searchResultsDiv.appendChild(resultDiv);
                   });
               } else {
                   searchResultsDiv.innerHTML = "<p>×œ× × ××¦××• ××¡××›×™× ×¨×œ×•×•× ×˜×™×™×.</p>";
               }

               resultsArea.style.display = "block";

           } catch (error) {
               console.error("Error:", error);
               alert("×©×’×™××”:\n" + error.message);
           } finally {
               loader.style.display = "none";
               submitBtn.disabled = false;
               submitBtn.innerText = "×—×¤×©";
           }
       }

       function highlightResult(num) {
           const element = document.getElementById(`result-${num}`);
           if (element) {
               element.classList.remove('highlight-result');
               void element.offsetWidth;
               element.classList.add('highlight-result');
               element.scrollIntoView({ behavior: 'smooth', block: 'center' });
           }
       }
   </script>
</body>
</html>