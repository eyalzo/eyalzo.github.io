<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
   <meta charset="UTF-8">
   <meta name="viewport" content="width=device-width, initial-scale=1.0">
   <title>Gilat AI - ××¡××›×™ ×”×.×.×</title>
   <link href="https://fonts.googleapis.com/css2?family=Heebo:wght@300;400;700&display=swap" rel="stylesheet">
   <style>
       :root {
           --primary-color: #0056b3;
           --bg-color: #f4f7f6;
           --container-bg: #ffffff;
       }

       body {
           font-family: 'Heebo', sans-serif;
           background-color: var(--bg-color);
           color: #333;
           margin: 0;
           padding: 20px;
           display: flex;
           justify-content: center;
       }

       .container {
           width: 100%;
           max-width: 800px;
           background-color: var(--container-bg);
           padding: 30px;
           border-radius: 12px;
           box-shadow: 0 4px 15px rgba(0,0,0,0.1);
       }

       h2 {
           color: var(--primary-color);
           text-align: center;
           margin-top: 0;
       }

       label {
           font-weight: bold;
           margin-top: 20px;
           display: block;
           margin-bottom: 5px;
       }

       input[type="text"] {
           width: 100%;
           padding: 12px;
           border: 1px solid #ddd;
           border-radius: 8px;
           box-sizing: border-box; /* ×—×©×•×‘ ×›×“×™ ×©×”-padding ×œ× ×™×—×¨×•×’ */
           font-size: 16px;
       }

       button {
           width: 100%;
           padding: 12px;
           background-color: var(--primary-color);
           color: white;
           border: none;
           border-radius: 8px;
           font-size: 18px;
           cursor: pointer;
           margin-top: 15px;
           transition: background 0.3s;
       }

       button:hover {
           background-color: #004494;
       }

       button:disabled {
           background-color: #ccc;
           cursor: not-allowed;
       }

       /* ××–×•×¨ ×”×ª×•×¦××•×ª */
       #results-area {
           margin-top: 30px;
           border-top: 1px solid #eee;
           padding-top: 20px;
       }

       h3 {
           color: var(--primary-color);
           border-bottom: 2px solid #eee;
           padding-bottom: 10px;
           margin-bottom: 15px;
       }

       textarea {
           width: 100%;
           height: 150px;
           padding: 10px;
           border: 1px solid #ddd;
           border-radius: 8px;
           resize: vertical;
           font-family: 'Heebo', sans-serif;
           background-color: #fafafa;
           box-sizing: border-box;
       }

       /* ×›×¨×˜×™×¡×™×•×ª ×—×™×¤×•×© */
       .search-result {
           background: #fff;
           border: 1px solid #e1e4e8;
           border-right: 4px solid var(--primary-color);
           padding: 15px;
           margin-bottom: 15px;
           border-radius: 6px;
           box-shadow: 0 2px 5px rgba(0,0,0,0.05);
       }

       .search-result .metadata {
           font-size: 0.85em;
           color: #666;
           margin-top: 10px;
           border-top: 1px dashed #eee;
           padding-top: 5px;
       }

       .document-title {
           font-weight: bold;
           color: var(--primary-color);
           text-decoration: none;
           font-size: 1.1em;
       }

       .document-title:hover {
           text-decoration: underline;
       }

       /* ×× ×™××¦×™×™×ª ×˜×¢×™× ×” */
       .loader {
           border: 5px solid #f3f3f3;
           border-top: 5px solid var(--primary-color);
           border-radius: 50%;
           width: 40px;
           height: 40px;
           animation: spin 1s linear infinite;
           margin: 20px auto;
           display: none; /* ××•×¡×ª×¨ ×›×‘×¨×™×¨×ª ××—×“×œ */
       }

       @keyframes spin {
           0% { transform: rotate(0deg); }
           100% { transform: rotate(360deg); }
       }
   </style>
</head>
<body>

   <div class="container">
       <h2>ğŸ›ï¸ Gilat AI - ×—×™×¤×•×© ×‘××¡××›×™ ×”×.×.×</h2>

       <form onsubmit="sendQuery(); return false;">
           <label for="query">××” ×ª×¨×¦×• ×œ×—×¤×©?</label>
           <input type="text" id="query" placeholder="×œ××©×œ: ×”×©×¤×¢×•×ª ×”-AI ×¢×œ ×©×•×§ ×”×¢×‘×•×“×”..." required>
           <button type="submit" id="submitBtn">×—×¤×© ×‘××¡××›×™×</button>
       </form>

       <div id="loader" class="loader"></div>

       <div id="results-area" style="display:none;">
           <h3>âœ¨ ×¡×™×›×•× ×ª×©×•×‘×” (AI):</h3>
           <textarea id="result" readonly placeholder="×”×¡×™×›×•× ×™×•×¤×™×¢ ×›××Ÿ..."></textarea>

           <h3>ğŸ“š ××§×•×¨×•×ª ×¨×œ×•×•× ×˜×™×™×:</h3>
           <div id="search-results"></div>
       </div>
   </div>

   <script>
       async function sendQuery() {
           const apiKey = "zqt_WQdPgppS5OLumkFHZXSffKRBLzOS1MmAq-c0HA";
           const corpusKey = "mmm_docs5";

           const queryText = document.getElementById("query").value;
           const loader = document.getElementById("loader");
           const resultsArea = document.getElementById("results-area");
           const submitBtn = document.getElementById("submitBtn");
           const resultTextarea = document.getElementById("result");
           const searchResultsDiv = document.getElementById("search-results");

           if (!queryText.trim()) return;

           // ××™×¤×•×¡ ×××©×§ ×œ×¤× ×™ ×—×™×¤×•×©
           loader.style.display = "block";
           resultsArea.style.display = "none";
           submitBtn.disabled = true;
           submitBtn.innerText = "××¢×‘×“ × ×ª×•× ×™×...";
           resultTextarea.value = "";
           searchResultsDiv.innerHTML = "";

           // ×›×ª×•×‘×ª ×”-API ×©×œ Vectara v2
           const url = `https://api.vectara.io/v2/corpora/${corpusKey}/query`;

           // ×’×•×£ ×”×‘×§×©×” ×”××ª×•×§×Ÿ (×œ×œ× ×”×¤×¨××˜×¨ ×”×‘×¢×™×™×ª×™)
           const requestData = {
               query: queryText,
               search: {
                    metadata_filter: "",
                    lexical_interpolation: 0.005,
                    offset: 0,
                    limit: 10,
                    context_configuration: {
                       sentences_before: 2,
                       sentences_after: 2,
                       start_tag: "<b>",
                       end_tag: "</b>"
                    },
                    reranker: {
                       type: "customer_reranker",
                       reranker_name: "Rerank_Multilingual_v1"
                    }
                },
                generation: {
                   generation_preset_name: "mockingbird-1.0-2024-07-16",
                   max_used_search_results: 5,
                   response_language: "heb",
                   enable_factual_consistency_score: false,
                   citations: {
                        style: "html",
                        url_pattern: "{doc.id}#page={section.page}",
                        text_pattern: "{doc.title}"
                    }
                },
                stream_response: false,
                save_history: false
           };

           try {
               const response = await fetch(url, {
                   method: "POST",
                   headers: {
                       "Content-Type": "application/json",
                       "Accept": "application/json",
                       "x-api-key": apiKey
                   },
                   body: JSON.stringify(requestData)
               });

               if (!response.ok) {
                   const errorText = await response.text();
                   throw new Error(`×©×’×™××ª ×©×¨×ª: ${response.status} - ${errorText}`);
               }

               const data = await response.json();

               // ×”×¦×’×ª ×”×¡×™×›×•×
               resultTextarea.value = data.summary || "×œ× ×”×ª×§×‘×œ ×¡×™×›×•× ××• ×©×œ× × ××¦× ××™×“×¢ ×¨×œ×•×•× ×˜×™.";

               // ×”×¦×’×ª ×”×ª×•×¦××•×ª
               if (data.search_results && data.search_results.length > 0) {
                   data.search_results.forEach((result) => {
                       const resultDiv = document.createElement("div");
                       resultDiv.className = "search-result";

                       // ×™×¦×™×¨×ª ×§×™×©×•×¨ ×œ××¡××š (×‘××™×“×” ×•×™×© URL)
                       const docUrl = result.document_metadata.url
                           ? `${result.document_metadata.url}#page=${result.part_metadata.page}`
                           : '#';

                       // ×˜×™×¤×•×œ ×‘××—×‘×¨×™×
                       let authors = [];
                       if (result.document_metadata.author) authors.push(result.document_metadata.author);
                       if (result.document_metadata.teamleader) authors.push(`×¨"×¦: ${result.document_metadata.teamleader}`);
                       const authorsText = authors.length ? authors.join(', ') : '×œ× ×¦×•×™×Ÿ';

                       // ×‘× ×™×™×ª ×”-HTML ×©×œ ×”×ª×•×¦××”
                       resultDiv.innerHTML = `
                           <div class="metadata">
                               <a href="${docUrl}" target="_blank" class="document-title">ğŸ“„ ${result.document_metadata.title || '××¡××š ×œ×œ× ×›×•×ª×¨×ª'}</a>
                           </div>
                           <div style="margin-top:10px; line-height:1.5;">${result.text}</div>
                           <div class="metadata">
                               <strong>×ª××¨×™×š:</strong> ${result.document_metadata.date || '-'} |
                               <strong>××—×‘×¨×™×:</strong> ${authorsText} |
                               <strong>×¦×™×•×Ÿ ×”×ª×××”:</strong> ${(result.score * 100).toFixed(0)}%
                           </div>
                       `;

                       searchResultsDiv.appendChild(resultDiv);
                   });
               } else {
                   searchResultsDiv.innerHTML = "<p>×œ× × ××¦××• ×ª×•×¦××•×ª ×¨×œ×•×•× ×˜×™×•×ª.</p>";
               }

               // ×”×¦×’×ª ×”××–×•×¨
               resultsArea.style.display = "block";

           } catch (error) {
               console.error("Error details:", error);
               alert("×”×ª×¨×—×©×” ×©×’×™××” ×‘××”×œ×š ×”×—×™×¤×•×©:\n" + error.message);
           } finally {
               loader.style.display = "none";
               submitBtn.disabled = false;
               submitBtn.innerText = "×—×¤×© ×‘××¡××›×™×";
           }
       }
   </script>
</body>
</html>