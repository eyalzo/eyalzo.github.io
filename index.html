<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
   <meta charset="UTF-8">
   <meta name="viewport" content="width=device-width, initial-scale=1.0">
   <title>Gilat AI - ××¡××›×™ ×”×.×.×</title>
   <link href="https://fonts.googleapis.com/css2?family=Heebo:wght@300;400;700&display=swap" rel="stylesheet">
   <style>
       :root {
           --primary-color: #0056b3; /* ×›×—×•×œ ×××œ×›×ª×™ */
           --secondary-color: #f0f4f8;
           --accent-color: #ffcc00;
           --text-color: #333;
           --shadow: 0 4px 6px rgba(0,0,0,0.1);
       }

       body {
           font-family: 'Heebo', sans-serif;
           background-color: var(--secondary-color);
           color: var(--text-color);
           margin: 0;
           padding: 20px;
           line-height: 1.6;
       }

       .container {
           max-width: 800px;
           margin: 0 auto;
           background: white;
           padding: 30px;
           border-radius: 12px;
           box-shadow: var(--shadow);
       }

       h2 {
           color: var(--primary-color);
           text-align: center;
           margin-bottom: 30px;
           font-weight: 700;
       }

       label {
           font-weight: bold;
           margin-bottom: 8px;
           display: block;
       }

       input[type="text"] {
           width: 100%;
           padding: 12px;
           border: 1px solid #ddd;
           border-radius: 8px;
           box-sizing: border-box;
           font-size: 16px;
           transition: border-color 0.3s;
       }

       input[type="text"]:focus {
           border-color: var(--primary-color);
           outline: none;
       }

       button {
           background-color: var(--primary-color);
           color: white;
           border: none;
           padding: 12px 24px;
           border-radius: 8px;
           font-size: 16px;
           cursor: pointer;
           width: 100%;
           margin-top: 15px;
           font-weight: bold;
           transition: background 0.3s;
       }

       button:hover {
           background-color: #004494;
       }

       .section-title {
           border-bottom: 2px solid var(--primary-color);
           padding-bottom: 5px;
           margin-top: 30px;
           margin-bottom: 15px;
           color: var(--primary-color);
       }

       textarea {
           width: 100%;
           height: 120px;
           padding: 10px;
           border: 1px solid #ddd;
           border-radius: 8px;
           background-color: #fafafa;
           resize: vertical;
           font-family: 'Heebo', sans-serif;
       }

       /* ×¢×™×¦×•×‘ ×›×¨×˜×™×¡×™×™×ª ×ª×•×¦××” */
       .search-result {
           background: white;
           margin-bottom: 15px;
           padding: 20px;
           border-radius: 8px;
           border-right: 4px solid var(--primary-color);
           box-shadow: 0 2px 4px rgba(0,0,0,0.05);
           transition: transform 0.2s;
       }

       .search-result:hover {
           transform: translateY(-2px);
           box-shadow: 0 4px 8px rgba(0,0,0,0.1);
       }

       .search-result em {
           background-color: rgba(255, 204, 0, 0.4); /* ×”×“×’×©×” ×¢×“×™× ×” ×™×•×ª×¨ */
           font-style: normal;
           font-weight: bold;
           padding: 0 2px;
           border-radius: 2px;
       }

       .metadata {
           font-size: 0.85em;
           color: #666;
           margin-top: 12px;
           padding-top: 10px;
           border-top: 1px dashed #eee;
       }

       .document-title {
           color: var(--primary-color);
           text-decoration: none;
           font-weight: bold;
           font-size: 1.1em;
       }

       .document-title:hover {
           text-decoration: underline;
       }

       /* ×× ×™××¦×™×™×ª ×˜×¢×™× ×” */
       .loader {
           border: 4px solid #f3f3f3;
           border-top: 4px solid var(--primary-color);
           border-radius: 50%;
           width: 30px;
           height: 30px;
           animation: spin 1s linear infinite;
           margin: 20px auto;
           display: none;
       }

       @keyframes spin {
           0% { transform: rotate(0deg); }
           100% { transform: rotate(360deg); }
       }
   </style>
</head>
<body>

   <div class="container">
       <h2>ğŸ›ï¸ Gilat AI - ××¡××›×™ ×”×.×.×</h2>

       <form onsubmit="sendQuery(); return false;">
           <label for="query">××” ×ª×¨×¦×• ×œ×—×¤×© ×”×™×•×?</label>
           <input type="text" id="query" placeholder="×œ××©×œ: ××”×Ÿ ×”×”×©×¤×¢×•×ª ×©×œ ×‘×™× ×” ××œ××›×•×ª×™×ª ×¢×œ ×©×•×§ ×”×¢×‘×•×“×”?">
           <button type="submit" id="submitBtn">×—×¤×© ×‘××¡××›×™×</button>
       </form>

       <div id="loader" class="loader"></div>

       <div id="results-area" style="display:none;">
           <h3 class="section-title">âœ¨ ×¡×™×›×•× ×ª×©×•×‘×” (AI):</h3>
           <textarea id="result" readonly placeholder="×”×¡×™×›×•× ×™×•×¤×™×¢ ×›××Ÿ..."></textarea>

           <h3 class="section-title">ğŸ“š ××§×•×¨×•×ª ×¨×œ×•×•× ×˜×™×™×:</h3>
           <div id="search-results"></div>
       </div>
   </div>

   <script>
       async function sendQuery() {
           // ×©×™× ×œ×‘: ×™×© ×œ×¢×“×›×Ÿ ××ª ×”××¤×ª×— ×›××Ÿ
           const apiKey = "zqt_WQdPgppS5OLumkFHZXSffKRBLzOS1MmAq-c0HA";
           const corpusKey = "mmm_docs5";

           const queryText = document.getElementById("query").value;
           const loader = document.getElementById("loader");
           const resultsArea = document.getElementById("results-area");
           const submitBtn = document.getElementById("submitBtn");

           if (!queryText.trim()) {
               alert("×× × ×”×›× ×¡ ×©××™×œ×ª×");
               return;
           }

           // UI Updates for loading state
           loader.style.display = "block";
           resultsArea.style.display = "none";
           submitBtn.disabled = true;
           submitBtn.innerText = "××¢×‘×“ × ×ª×•× ×™×...";

           // *** ×ª×™×§×•×Ÿ ×§×¨×™×˜×™: ×©×™××•×© ×‘-Backticks ×¢×‘×•×¨ Template Literal ***
           const url = `https://api.vectara.io/v2/corpora/${corpusKey}/query`;

            const requestData = {
               query: queryText,
               search: {
                    metadata_filter: "",
                    lexical_interpolation: 0.005,
                    custom_dimensions: {},
                    offset: 0,
                    limit: 10,
                    context_configuration: {
                       sentences_before: 2,
                       sentences_after: 2,
                       start_tag: "<em>",
                       end_tag: "</em>"
                    },
                    reranker: {
                       type: "customer_reranker",
                       reranker_name: "Rerank_Multilingual_v1"
                    }
                },
                generation: {
                   generation_preset_name: "mockingbird-1.0-2024-07-16",
                   max_used_search_results: 5,
                   // ×©×™× ×•×™ ×œ×¢×‘×¨×™×ª ×›×“×™ ×©×”×¡×™×›×•× ×™×¦× ×‘×©×¤×ª ×”×™×¢×“
                   response_language: "heb",
                   enable_factual_consistency_score: false,
                   citations: {
                        style: "html",
                        url_pattern: "{doc.id}#page={section.page}",
                        text_pattern: "as seen in {doc.title}"
                    }
                },
                stream_response: false,
                save_history: false
            };

           try {
               const response = await fetch(url, {
                   method: "POST",
                   headers: {
                       "Content-Type": "application/json",
                       "Accept": "application/json",
                       "x-api-key": apiKey
                   },
                   body: JSON.stringify(requestData)
               });

               if (!response.ok) {
                   const errorData = await response.json();
                   throw new Error(errorData.message || `HTTP Error: ${response.status}`);
               }

               const data = await response.json();

               // ×”×¦×’×ª ×”×¡×™×›×•×
               document.getElementById("result").value = data.summary || "×œ× ×”×ª×§×‘×œ ×¡×™×›×•×.";

               // ×”×¦×’×ª ×ª×•×¦××•×ª ×”×—×™×¤×•×©
               const searchResultsDiv = document.getElementById("search-results");
               searchResultsDiv.innerHTML = "";

               if (data.search_results && data.search_results.length > 0) {
                   data.search_results.forEach((result) => {
                       const resultDiv = document.createElement("div");
                       resultDiv.className = "search-result";

                       // *** ×ª×™×§×•×Ÿ ×§×¨×™×˜×™: ×‘× ×™×™×ª ×”××—×¨×•×–×•×ª ×¢× Backticks ***
                       const documentUrl = result.document_metadata.url ?
                           `${result.document_metadata.url}#page=${result.part_metadata.page}` : '#';

                       let authors = [];
                       if (result.document_metadata.author) authors.push(result.document_metadata.author);
                       if (result.document_metadata.teamleader) authors.push(`×¨"×¦: ${result.document_metadata.teamleader}`);

                       // ×™×¦×™×¨×ª ×”-HTML
                       const content = `
                           <div class="metadata">
                               <a href="${documentUrl}" target="_blank" class="document-title">ğŸ“„ ${result.document_metadata.title || '××¡××š ×œ×œ× ×›×•×ª×¨×ª'}</a>
                           </div>
                           <div class="text" style="margin-top:10px;">${result.text}</div>
                           <div class="metadata">
                               <strong>×ª××¨×™×š:</strong> ${result.document_metadata.date || '×œ× ×™×“×•×¢'} |
                               <strong>××—×‘×¨×™×:</strong> ${authors.length ? authors.join(', ') : '×œ× ×¦×•×™×Ÿ'}
                           </div>
                       `;

                       resultDiv.innerHTML = content;
                       searchResultsDiv.appendChild(resultDiv);
                   });
               } else {
                   searchResultsDiv.innerHTML = "<p>×œ× × ××¦××• ×ª×•×¦××•×ª ×¨×œ×•×•× ×˜×™×•×ª.</p>";
               }

               resultsArea.style.display = "block";

           } catch (error) {
               alert("×©×’×™××” ×‘×—×™×¤×•×©:\n" + error.message);
               console.error("Error:", error);
           } finally {
               loader.style.display = "none";
               submitBtn.disabled = false;
               submitBtn.innerText = "×—×¤×© ×‘××¡××›×™×";
           }
       }
   </script>
</body>
</html>