<script>
async function sendQuery() {
  const apiKey = "zqt_WQdPgppS5OLumkFHZXSffKRBLzOS1MmAq-c0HA";
  const corpusKey = "mmm_docs5";
  const queryText = document.getElementById("query").value;

  const url = `https://api.vectara.io/v2/corpora/${corpusKey}/query`;

  const requestData = {
    query_text: queryText,
    search: {
      limit: 5
    },
    generation: {
      generation_preset_name: "mockingbird-1.0-2024-07-16"
    }
  };

  document.getElementById("search-results").innerText = "מחפש...";

  try {
    const response = await fetch(url, {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
        "x-api-key": apiKey
      },
      body: JSON.stringify(requestData)
    });

    const data = await response.json();
    console.log(data); // חשוב!

    document.getElementById("result").value =
      data?.response?.summary?.text || "אין סיכום";

    const resultsDiv = document.getElementById("search-results");
    resultsDiv.innerHTML = "";

    (data?.response?.search_results || []).forEach(r => {
      const div = document.createElement("div");
      div.className = "search-result";
      div.innerHTML = `
        <div>${r.text}</div>
        <div class="metadata">
          <strong>${r.document?.title || ""}</strong>
        </div>
      `;
      resultsDiv.appendChild(div);
    });

  } catch (e) {
    document.getElementById("search-results").innerText =
      "שגיאה: " + e.message;
  }
}
</script>
