
<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <script src="https://cdn.plot.ly/plotly-2.24.1.min.js"></script>
    <style>
        body { font-family: 'Segoe UI', Tahoma, sans-serif; background-color: #f0f2f5; margin: 0; padding: 15px; }
        .container { background: white; padding: 25px; border-radius: 15px; box-shadow: 0 4px 20px rgba(0,0,0,0.08); max-width: 1250px; margin: auto; }
        .header { display: flex; justify-content: space-between; align-items: center; border-bottom: 2px solid #eee; margin-bottom: 20px; padding-bottom: 15px; }
        .filters { background: #f8fafc; padding: 15px; border-radius: 10px; display: flex; align-items: center; justify-content: center; gap: 20px; margin-bottom: 20px; border: 1px solid #e2e8f0; }
        .kpi-row { display: grid; grid-template-columns: repeat(4, 1fr); gap: 15px; margin-bottom: 25px; }
        .kpi-card { background: #fff; border: 1px solid #e2e8f0; padding: 15px; border-radius: 10px; text-align: center; }
        .kpi-val { font-size: 24px; font-weight: bold; color: #1a73e8; }
        .charts-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px; }
        .full-chart { grid-column: span 2; border: 1px solid #eee; border-radius: 10px; padding: 10px; }
        input[type="range"] { width: 200px; cursor: pointer; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h2 style="margin:0">דשבורד בקשות ומענים - כנסת ישראל (14,172 בקשות)</h2>
            <button style="background:#1a73e8; color:white; border:none; padding:8px 15px; border-radius:5px; cursor:pointer" onclick="downloadHTML()">הורד דשבורד</button>
        </div>

        <div class="filters">
            <span>מ- <span id="minL" style="color:#1a73e8; font-weight:bold">1999</span></span>
            <input type="range" id="minS" min="1999" max="2025" value="1999">
            <input type="range" id="maxS" min="1999" max="2025" value="2025">
            <span>עד <span id="maxL" style="color:#1a73e8; font-weight:bold">2025</span></span>
        </div>

        <div class="kpi-row">
            <div class="kpi-card">סה"כ משימות<div id="kTotal" class="kpi-val"></div></div>
            <div class="kpi-card">בוצעו (סה"כ)<div id="kDone" class="kpi-val" style="color:#28a745"></div></div>
            <div class="kpi-card">בביצוע (פתוח)<div id="kPending" class="kpi-val" style="color:#fd7e14"></div></div>
            <div class="kpi-card">נסגר/בוטל<div id="kClosed" class="kpi-val" style="color:#dc3545"></div></div>
        </div>

        <div class="charts-grid">
            <div id="barChart" class="full-chart" style="height: 350px;"></div>
            <div id="pieRequests" style="height: 500px; border:1px solid #eee; border-radius:10px"></div>
            <div id="pieDelivery" style="height: 500px; border:1px solid #eee; border-radius:10px"></div>
        </div>
    </div>

    <script>
        const reqData = [{"year": 1999, "status_final": "בוצע", "client_type_final": "ועדה", "count": 1}, {"year": 2000, "status_final": "בוצע", "client_type_final": "ועדה", "count": 93}, {"year": 2000, "status_final": "בוצע", "client_type_final": "ח\"כ", "count": 14}, {"year": 2000, "status_final": "בוצע", "client_type_final": "יחידה פנימית", "count": 5}, {"year": 2001, "status_final": "בוצע", "client_type_final": "אחר", "count": 3}, {"year": 2001, "status_final": "בוצע", "client_type_final": "ועדה", "count": 322}, {"year": 2001, "status_final": "בוצע", "client_type_final": "ח\"כ", "count": 82}, {"year": 2001, "status_final": "בוצע", "client_type_final": "יחידה פנימית", "count": 23}, {"year": 2001, "status_final": "נסגר או בוטל", "client_type_final": "ח\"כ", "count": 1}, {"year": 2002, "status_final": "בוצע", "client_type_final": "אחר", "count": 11}, {"year": 2002, "status_final": "בוצע", "client_type_final": "ועדה", "count": 312}, {"year": 2002, "status_final": "בוצע", "client_type_final": "ח\"כ", "count": 94}, {"year": 2002, "status_final": "בוצע", "client_type_final": "יחידה פנימית", "count": 31}, {"year": 2003, "status_final": "בוצע", "client_type_final": "אחר", "count": 1}, {"year": 2003, "status_final": "בוצע", "client_type_final": "ועדה", "count": 372}, {"year": 2003, "status_final": "בוצע", "client_type_final": "ח\"כ", "count": 169}, {"year": 2003, "status_final": "בוצע", "client_type_final": "יחידה פנימית", "count": 38}, {"year": 2003, "status_final": "נסגר או בוטל", "client_type_final": "יחידה פנימית", "count": 1}, {"year": 2004, "status_final": "בוצע", "client_type_final": "אחר", "count": 6}, {"year": 2004, "status_final": "בוצע", "client_type_final": "ועדה", "count": 424}, {"year": 2004, "status_final": "בוצע", "client_type_final": "ח\"כ", "count": 155}, {"year": 2004, "status_final": "בוצע", "client_type_final": "יחידה פנימית", "count": 35}, {"year": 2004, "status_final": "נסגר או בוטל", "client_type_final": "ועדה", "count": 1}, {"year": 2004, "status_final": "נסגר או בוטל", "client_type_final": "יחידה פנימית", "count": 1}, {"year": 2005, "status_final": "בוצע", "client_type_final": "אחר", "count": 15}, {"year": 2005, "status_final": "בוצע", "client_type_final": "ועדה", "count": 246}, {"year": 2005, "status_final": "בוצע", "client_type_final": "ח\"כ", "count": 155}, {"year": 2005, "status_final": "בוצע", "client_type_final": "יזומים", "count": 2}, {"year": 2005, "status_final": "בוצע", "client_type_final": "יחידה פנימית", "count": 24}, {"year": 2006, "status_final": "בוצע", "client_type_final": "אחר", "count": 1}, {"year": 2006, "status_final": "בוצע", "client_type_final": "ועדה", "count": 302}, {"year": 2006, "status_final": "בוצע", "client_type_final": "ח\"כ", "count": 221}, {"year": 2006, "status_final": "בוצע", "client_type_final": "יחידה פנימית", "count": 41}, {"year": 2006, "status_final": "נסגר או בוטל", "client_type_final": "ועדה", "count": 21}, {"year": 2006, "status_final": "נסגר או בוטל", "client_type_final": "ח\"כ", "count": 14}, {"year": 2006, "status_final": "נסגר או בוטל", "client_type_final": "יחידה פנימית", "count": 3}, {"year": 2007, "status_final": "בוצע", "client_type_final": "ועדה", "count": 313}, {"year": 2007, "status_final": "בוצע", "client_type_final": "ח\"כ", "count": 237}, {"year": 2007, "status_final": "בוצע", "client_type_final": "יזומים", "count": 1}, {"year": 2007, "status_final": "בוצע", "client_type_final": "יחידה פנימית", "count": 33}, {"year": 2007, "status_final": "נסגר או בוטל", "client_type_final": "ועדה", "count": 33}, {"year": 2007, "status_final": "נסגר או בוטל", "client_type_final": "ח\"כ", "count": 69}, {"year": 2007, "status_final": "נסגר או בוטל", "client_type_final": "יחידה פנימית", "count": 14}, {"year": 2008, "status_final": "בוצע", "client_type_final": "ועדה", "count": 205}, {"year": 2008, "status_final": "בוצע", "client_type_final": "ח\"כ", "count": 150}, {"year": 2008, "status_final": "בוצע", "client_type_final": "יזומים", "count": 1}, {"year": 2008, "status_final": "בוצע", "client_type_final": "יחידה פנימית", "count": 33}, {"year": 2008, "status_final": "נסגר או בוטל", "client_type_final": "ועדה", "count": 21}, {"year": 2008, "status_final": "נסגר או בוטל", "client_type_final": "ח\"כ", "count": 87}, {"year": 2008, "status_final": "נסגר או בוטל", "client_type_final": "יחידה פנימית", "count": 7}, {"year": 2009, "status_final": "בוצע", "client_type_final": "ועדה", "count": 255}, {"year": 2009, "status_final": "בוצע", "client_type_final": "ח\"כ", "count": 231}, {"year": 2009, "status_final": "בוצע", "client_type_final": "יזומים", "count": 1}, {"year": 2009, "status_final": "בוצע", "client_type_final": "יחידה פנימית", "count": 30}, {"year": 2009, "status_final": "נסגר או בוטל", "client_type_final": "ועדה", "count": 26}, {"year": 2009, "status_final": "נסגר או בוטל", "client_type_final": "ח\"כ", "count": 69}, {"year": 2009, "status_final": "נסגר או בוטל", "client_type_final": "יחידה פנימית", "count": 1}, {"year": 2010, "status_final": "בוצע", "client_type_final": "ועדה", "count": 308}, {"year": 2010, "status_final": "בוצע", "client_type_final": "ח\"כ", "count": 205}, {"year": 2010, "status_final": "בוצע", "client_type_final": "יחידה פנימית", "count": 32}, {"year": 2010, "status_final": "נסגר או בוטל", "client_type_final": "ועדה", "count": 30}, {"year": 2010, "status_final": "נסגר או בוטל", "client_type_final": "ח\"כ", "count": 59}, {"year": 2010, "status_final": "נסגר או בוטל", "client_type_final": "יחידה פנימית", "count": 6}, {"year": 2011, "status_final": "בוצע", "client_type_final": "ועדה", "count": 201}, {"year": 2011, "status_final": "בוצע", "client_type_final": "ח\"כ", "count": 191}, {"year": 2011, "status_final": "בוצע", "client_type_final": "יחידה פנימית", "count": 25}, {"year": 2011, "status_final": "נסגר או בוטל", "client_type_final": "ועדה", "count": 18}, {"year": 2011, "status_final": "נסגר או בוטל", "client_type_final": "ח\"כ", "count": 81}, {"year": 2012, "status_final": "בוצע", "client_type_final": "ועדה", "count": 146}, {"year": 2012, "status_final": "בוצע", "client_type_final": "ח\"כ", "count": 128}, {"year": 2012, "status_final": "בוצע", "client_type_final": "יזומים", "count": 1}, {"year": 2012, "status_final": "בוצע", "client_type_final": "יחידה פנימית", "count": 22}, {"year": 2012, "status_final": "נסגר או בוטל", "client_type_final": "ועדה", "count": 19}, {"year": 2012, "status_final": "נסגר או בוטל", "client_type_final": "ח\"כ", "count": 53}, {"year": 2012, "status_final": "נסגר או בוטל", "client_type_final": "יחידה פנימית", "count": 3}, {"year": 2013, "status_final": "בוצע", "client_type_final": "ועדה", "count": 212}, {"year": 2013, "status_final": "בוצע", "client_type_final": "ח\"כ", "count": 325}, {"year": 2013, "status_final": "בוצע", "client_type_final": "יזומים", "count": 1}, {"year": 2013, "status_final": "בוצע", "client_type_final": "יחידה פנימית", "count": 28}, {"year": 2013, "status_final": "נסגר או בוטל", "client_type_final": "ועדה", "count": 7}, {"year": 2013, "status_final": "נסגר או בוטל", "client_type_final": "ח\"כ", "count": 12}, {"year": 2013, "status_final": "נסגר או בוטל", "client_type_final": "יחידה פנימית", "count": 3}, {"year": 2014, "status_final": "בוצע", "client_type_final": "ועדה", "count": 147}, {"year": 2014, "status_final": "בוצע", "client_type_final": "ח\"כ", "count": 206}, {"year": 2014, "status_final": "בוצע", "client_type_final": "יזומים", "count": 1}, {"year": 2014, "status_final": "בוצע", "client_type_final": "יחידה פנימית", "count": 32}, {"year": 2014, "status_final": "נסגר או בוטל", "client_type_final": "ועדה", "count": 7}, {"year": 2014, "status_final": "נסגר או בוטל", "client_type_final": "ח\"כ", "count": 35}, {"year": 2014, "status_final": "נסגר או בוטל", "client_type_final": "יחידה פנימית", "count": 3}, {"year": 2015, "status_final": "בוצע", "client_type_final": "ועדה", "count": 206}, {"year": 2015, "status_final": "בוצע", "client_type_final": "ח\"כ", "count": 312}, {"year": 2015, "status_final": "בוצע", "client_type_final": "יזומים", "count": 5}, {"year": 2015, "status_final": "בוצע", "client_type_final": "יחידה פנימית", "count": 36}, {"year": 2015, "status_final": "נסגר או בוטל", "client_type_final": "ועדה", "count": 15}, {"year": 2015, "status_final": "נסגר או בוטל", "client_type_final": "ח\"כ", "count": 69}, {"year": 2015, "status_final": "נסגר או בוטל", "client_type_final": "יחידה פנימית", "count": 2}, {"year": 2016, "status_final": "בוצע", "client_type_final": "ועדה", "count": 207}, {"year": 2016, "status_final": "בוצע", "client_type_final": "ח\"כ", "count": 305}, {"year": 2016, "status_final": "בוצע", "client_type_final": "יזומים", "count": 4}, {"year": 2016, "status_final": "בוצע", "client_type_final": "יחידה פנימית", "count": 26}, {"year": 2016, "status_final": "נסגר או בוטל", "client_type_final": "ועדה", "count": 20}, {"year": 2016, "status_final": "נסגר או בוטל", "client_type_final": "ח\"כ", "count": 43}, {"year": 2017, "status_final": "בוצע", "client_type_final": "ועדה", "count": 181}, {"year": 2017, "status_final": "בוצע", "client_type_final": "ח\"כ", "count": 202}, {"year": 2017, "status_final": "בוצע", "client_type_final": "יזומים", "count": 6}, {"year": 2017, "status_final": "בוצע", "client_type_final": "יחידה פנימית", "count": 44}, {"year": 2017, "status_final": "נסגר או בוטל", "client_type_final": "ועדה", "count": 18}, {"year": 2017, "status_final": "נסגר או בוטל", "client_type_final": "ח\"כ", "count": 45}, {"year": 2017, "status_final": "נסגר או בוטל", "client_type_final": "יזומים", "count": 1}, {"year": 2017, "status_final": "נסגר או בוטל", "client_type_final": "יחידה פנימית", "count": 1}, {"year": 2018, "status_final": "בוצע", "client_type_final": "ועדה", "count": 165}, {"year": 2018, "status_final": "בוצע", "client_type_final": "ח\"כ", "count": 151}, {"year": 2018, "status_final": "בוצע", "client_type_final": "יזומים", "count": 21}, {"year": 2018, "status_final": "בוצע", "client_type_final": "יחידה פנימית", "count": 60}, {"year": 2018, "status_final": "נסגר או בוטל", "client_type_final": "ועדה", "count": 16}, {"year": 2018, "status_final": "נסגר או בוטל", "client_type_final": "ח\"כ", "count": 42}, {"year": 2018, "status_final": "נסגר או בוטל", "client_type_final": "יזומים", "count": 5}, {"year": 2018, "status_final": "נסגר או בוטל", "client_type_final": "יחידה פנימית", "count": 9}, {"year": 2019, "status_final": "בוצע", "client_type_final": "ועדה", "count": 35}, {"year": 2019, "status_final": "בוצע", "client_type_final": "ח\"כ", "count": 120}, {"year": 2019, "status_final": "בוצע", "client_type_final": "יזומים", "count": 47}, {"year": 2019, "status_final": "בוצע", "client_type_final": "יחידה פנימית", "count": 44}, {"year": 2019, "status_final": "נסגר או בוטל", "client_type_final": "ועדה", "count": 7}, {"year": 2019, "status_final": "נסגר או בוטל", "client_type_final": "ח\"כ", "count": 24}, {"year": 2019, "status_final": "נסגר או בוטל", "client_type_final": "יזומים", "count": 16}, {"year": 2019, "status_final": "נסגר או בוטל", "client_type_final": "יחידה פנימית", "count": 8}, {"year": 2020, "status_final": "בוצע", "client_type_final": "אחר", "count": 1}, {"year": 2020, "status_final": "בוצע", "client_type_final": "ועדה", "count": 289}, {"year": 2020, "status_final": "בוצע", "client_type_final": "ח\"כ", "count": 287}, {"year": 2020, "status_final": "בוצע", "client_type_final": "יזומים", "count": 26}, {"year": 2020, "status_final": "בוצע", "client_type_final": "יחידה פנימית", "count": 40}, {"year": 2020, "status_final": "נסגר או בוטל", "client_type_final": "ועדה", "count": 15}, {"year": 2020, "status_final": "נסגר או בוטל", "client_type_final": "ח\"כ", "count": 59}, {"year": 2020, "status_final": "נסגר או בוטל", "client_type_final": "יזומים", "count": 10}, {"year": 2020, "status_final": "נסגר או בוטל", "client_type_final": "יחידה פנימית", "count": 2}, {"year": 2021, "status_final": "בוצע", "client_type_final": "ועדה", "count": 225}, {"year": 2021, "status_final": "בוצע", "client_type_final": "ח\"כ", "count": 261}, {"year": 2021, "status_final": "בוצע", "client_type_final": "יזומים", "count": 30}, {"year": 2021, "status_final": "בוצע", "client_type_final": "יחידה פנימית", "count": 57}, {"year": 2021, "status_final": "נסגר או בוטל", "client_type_final": "ועדה", "count": 18}, {"year": 2021, "status_final": "נסגר או בוטל", "client_type_final": "ח\"כ", "count": 31}, {"year": 2021, "status_final": "נסגר או בוטל", "client_type_final": "יזומים", "count": 10}, {"year": 2021, "status_final": "נסגר או בוטל", "client_type_final": "יחידה פנימית", "count": 6}, {"year": 2022, "status_final": "בביצוע", "client_type_final": "ועדה", "count": 1}, {"year": 2022, "status_final": "בוצע", "client_type_final": "ועדה", "count": 152}, {"year": 2022, "status_final": "בוצע", "client_type_final": "ח\"כ", "count": 177}, {"year": 2022, "status_final": "בוצע", "client_type_final": "יזומים", "count": 76}, {"year": 2022, "status_final": "בוצע", "client_type_final": "יחידה פנימית", "count": 34}, {"year": 2022, "status_final": "נסגר או בוטל", "client_type_final": "ועדה", "count": 10}, {"year": 2022, "status_final": "נסגר או בוטל", "client_type_final": "ח\"כ", "count": 42}, {"year": 2022, "status_final": "נסגר או בוטל", "client_type_final": "יזומים", "count": 2}, {"year": 2022, "status_final": "נסגר או בוטל", "client_type_final": "יחידה פנימית", "count": 7}, {"year": 2023, "status_final": "בביצוע", "client_type_final": "ועדה", "count": 3}, {"year": 2023, "status_final": "בביצוע", "client_type_final": "ח\"כ", "count": 1}, {"year": 2023, "status_final": "בביצוע", "client_type_final": "יזומים", "count": 3}, {"year": 2023, "status_final": "בוצע", "client_type_final": "ועדה", "count": 380}, {"year": 2023, "status_final": "בוצע", "client_type_final": "ח\"כ", "count": 221}, {"year": 2023, "status_final": "בוצע", "client_type_final": "יזומים", "count": 61}, {"year": 2023, "status_final": "בוצע", "client_type_final": "יחידה פנימית", "count": 64}, {"year": 2023, "status_final": "נסגר או בוטל", "client_type_final": "ועדה", "count": 23}, {"year": 2023, "status_final": "נסגר או בוטל", "client_type_final": "ח\"כ", "count": 49}, {"year": 2023, "status_final": "נסגר או בוטל", "client_type_final": "יזומים", "count": 6}, {"year": 2023, "status_final": "נסגר או בוטל", "client_type_final": "יחידה פנימית", "count": 5}, {"year": 2024, "status_final": "בביצוע", "client_type_final": "ועדה", "count": 5}, {"year": 2024, "status_final": "בביצוע", "client_type_final": "ח\"כ", "count": 6}, {"year": 2024, "status_final": "בביצוע", "client_type_final": "יזומים", "count": 1}, {"year": 2024, "status_final": "בוצע", "client_type_final": "ועדה", "count": 295}, {"year": 2024, "status_final": "בוצע", "client_type_final": "ח\"כ", "count": 198}, {"year": 2024, "status_final": "בוצע", "client_type_final": "יזומים", "count": 53}, {"year": 2024, "status_final": "בוצע", "client_type_final": "יחידה פנימית", "count": 61}, {"year": 2024, "status_final": "ממתין למידע מהלקוח", "client_type_final": "ועדה", "count": 1}, {"year": 2024, "status_final": "ממתין למידע מהלקוח", "client_type_final": "ח\"כ", "count": 1}, {"year": 2024, "status_final": "נסגר או בוטל", "client_type_final": "ועדה", "count": 14}, {"year": 2024, "status_final": "נסגר או בוטל", "client_type_final": "ח\"כ", "count": 19}, {"year": 2024, "status_final": "נסגר או בוטל", "client_type_final": "יזומים", "count": 4}, {"year": 2024, "status_final": "נסגר או בוטל", "client_type_final": "יחידה פנימית", "count": 5}, {"year": 2025, "status_final": "בביצוע", "client_type_final": "ועדה", "count": 47}, {"year": 2025, "status_final": "בביצוע", "client_type_final": "ח\"כ", "count": 52}, {"year": 2025, "status_final": "בביצוע", "client_type_final": "יזומים", "count": 7}, {"year": 2025, "status_final": "בביצוע", "client_type_final": "יחידה פנימית", "count": 2}, {"year": 2025, "status_final": "בוצע", "client_type_final": "ועדה", "count": 280}, {"year": 2025, "status_final": "בוצע", "client_type_final": "ח\"כ", "count": 195}, {"year": 2025, "status_final": "בוצע", "client_type_final": "יזומים", "count": 46}, {"year": 2025, "status_final": "בוצע", "client_type_final": "יחידה פנימית", "count": 32}, {"year": 2025, "status_final": "בתהליך מול דברי הכנסת", "client_type_final": "ועדה", "count": 2}, {"year": 2025, "status_final": "ממתין למידע מהלקוח", "client_type_final": "ח\"כ", "count": 3}, {"year": 2025, "status_final": "נסגר או בוטל", "client_type_final": "ועדה", "count": 15}, {"year": 2025, "status_final": "נסגר או בוטל", "client_type_final": "ח\"כ", "count": 16}, {"year": 2025, "status_final": "נסגר או בוטל", "client_type_final": "יזומים", "count": 3}, {"year": 2025, "status_final": "נסגר או בוטל", "client_type_final": "יחידה פנימית", "count": 3}];
        const delData = [{"delivery_year": 1999, "client_type_final": "ועדה", "count": 1}, {"delivery_year": 2000, "client_type_final": "ועדה", "count": 94}, {"delivery_year": 2000, "client_type_final": "ח\"כ", "count": 14}, {"delivery_year": 2000, "client_type_final": "יחידה פנימית", "count": 5}, {"delivery_year": 2001, "client_type_final": "אחר", "count": 3}, {"delivery_year": 2001, "client_type_final": "ועדה", "count": 323}, {"delivery_year": 2001, "client_type_final": "ח\"כ", "count": 82}, {"delivery_year": 2001, "client_type_final": "יחידה פנימית", "count": 23}, {"delivery_year": 2002, "client_type_final": "אחר", "count": 11}, {"delivery_year": 2002, "client_type_final": "ועדה", "count": 310}, {"delivery_year": 2002, "client_type_final": "ח\"כ", "count": 94}, {"delivery_year": 2002, "client_type_final": "יחידה פנימית", "count": 31}, {"delivery_year": 2003, "client_type_final": "אחר", "count": 1}, {"delivery_year": 2003, "client_type_final": "ועדה", "count": 372}, {"delivery_year": 2003, "client_type_final": "ח\"כ", "count": 169}, {"delivery_year": 2003, "client_type_final": "יחידה פנימית", "count": 38}, {"delivery_year": 2004, "client_type_final": "אחר", "count": 6}, {"delivery_year": 2004, "client_type_final": "ועדה", "count": 424}, {"delivery_year": 2004, "client_type_final": "ח\"כ", "count": 155}, {"delivery_year": 2004, "client_type_final": "יחידה פנימית", "count": 35}, {"delivery_year": 2005, "client_type_final": "אחר", "count": 15}, {"delivery_year": 2005, "client_type_final": "ועדה", "count": 246}, {"delivery_year": 2005, "client_type_final": "ח\"כ", "count": 155}, {"delivery_year": 2005, "client_type_final": "יזומים", "count": 2}, {"delivery_year": 2005, "client_type_final": "יחידה פנימית", "count": 24}, {"delivery_year": 2006, "client_type_final": "אחר", "count": 1}, {"delivery_year": 2006, "client_type_final": "ועדה", "count": 251}, {"delivery_year": 2006, "client_type_final": "ח\"כ", "count": 160}, {"delivery_year": 2006, "client_type_final": "יחידה פנימית", "count": 35}, {"delivery_year": 2007, "client_type_final": "ועדה", "count": 271}, {"delivery_year": 2007, "client_type_final": "ח\"כ", "count": 177}, {"delivery_year": 2007, "client_type_final": "יזומים", "count": 1}, {"delivery_year": 2007, "client_type_final": "יחידה פנימית", "count": 24}, {"delivery_year": 2008, "client_type_final": "ועדה", "count": 194}, {"delivery_year": 2008, "client_type_final": "ח\"כ", "count": 139}, {"delivery_year": 2008, "client_type_final": "יזומים", "count": 1}, {"delivery_year": 2008, "client_type_final": "יחידה פנימית", "count": 21}, {"delivery_year": 2009, "client_type_final": "ועדה", "count": 224}, {"delivery_year": 2009, "client_type_final": "ח\"כ", "count": 140}, {"delivery_year": 2009, "client_type_final": "יזומים", "count": 1}, {"delivery_year": 2009, "client_type_final": "יחידה פנימית", "count": 29}, {"delivery_year": 2010, "client_type_final": "ועדה", "count": 290}, {"delivery_year": 2010, "client_type_final": "ח\"כ", "count": 194}, {"delivery_year": 2010, "client_type_final": "יחידה פנימית", "count": 25}, {"delivery_year": 2011, "client_type_final": "ועדה", "count": 183}, {"delivery_year": 2011, "client_type_final": "ח\"כ", "count": 110}, {"delivery_year": 2011, "client_type_final": "יחידה פנימית", "count": 20}, {"delivery_year": 2012, "client_type_final": "ועדה", "count": 148}, {"delivery_year": 2012, "client_type_final": "ח\"כ", "count": 145}, {"delivery_year": 2012, "client_type_final": "יזומים", "count": 1}, {"delivery_year": 2012, "client_type_final": "יחידה פנימית", "count": 22}, {"delivery_year": 2013, "client_type_final": "ועדה", "count": 203}, {"delivery_year": 2013, "client_type_final": "ח\"כ", "count": 260}, {"delivery_year": 2013, "client_type_final": "יחידה פנימית", "count": 27}, {"delivery_year": 2014, "client_type_final": "ועדה", "count": 160}, {"delivery_year": 2014, "client_type_final": "ח\"כ", "count": 253}, {"delivery_year": 2014, "client_type_final": "יחידה פנימית", "count": 27}, {"delivery_year": 2015, "client_type_final": "ועדה", "count": 187}, {"delivery_year": 2015, "client_type_final": "ח\"כ", "count": 278}, {"delivery_year": 2015, "client_type_final": "יזומים", "count": 6}, {"delivery_year": 2015, "client_type_final": "יחידה פנימית", "count": 40}, {"delivery_year": 2016, "client_type_final": "ועדה", "count": 213}, {"delivery_year": 2016, "client_type_final": "ח\"כ", "count": 310}, {"delivery_year": 2016, "client_type_final": "יזומים", "count": 4}, {"delivery_year": 2016, "client_type_final": "יחידה פנימית", "count": 30}, {"delivery_year": 2017, "client_type_final": "ועדה", "count": 177}, {"delivery_year": 2017, "client_type_final": "ח\"כ", "count": 234}, {"delivery_year": 2017, "client_type_final": "יזומים", "count": 4}, {"delivery_year": 2017, "client_type_final": "יחידה פנימית", "count": 41}, {"delivery_year": 2018, "client_type_final": "ועדה", "count": 176}, {"delivery_year": 2018, "client_type_final": "ח\"כ", "count": 164}, {"delivery_year": 2018, "client_type_final": "יזומים", "count": 20}, {"delivery_year": 2018, "client_type_final": "יחידה פנימית", "count": 51}, {"delivery_year": 2019, "client_type_final": "ועדה", "count": 43}, {"delivery_year": 2019, "client_type_final": "ח\"כ", "count": 108}, {"delivery_year": 2019, "client_type_final": "יזומים", "count": 49}, {"delivery_year": 2019, "client_type_final": "יחידה פנימית", "count": 46}, {"delivery_year": 2020, "client_type_final": "אחר", "count": 1}, {"delivery_year": 2020, "client_type_final": "ועדה", "count": 278}, {"delivery_year": 2020, "client_type_final": "ח\"כ", "count": 275}, {"delivery_year": 2020, "client_type_final": "יזומים", "count": 19}, {"delivery_year": 2020, "client_type_final": "יחידה פנימית", "count": 41}, {"delivery_year": 2021, "client_type_final": "ועדה", "count": 211}, {"delivery_year": 2021, "client_type_final": "ח\"כ", "count": 242}, {"delivery_year": 2021, "client_type_final": "יזומים", "count": 34}, {"delivery_year": 2021, "client_type_final": "יחידה פנימית", "count": 59}, {"delivery_year": 2022, "client_type_final": "ועדה", "count": 155}, {"delivery_year": 2022, "client_type_final": "ח\"כ", "count": 213}, {"delivery_year": 2022, "client_type_final": "יזומים", "count": 73}, {"delivery_year": 2022, "client_type_final": "יחידה פנימית", "count": 34}, {"delivery_year": 2023, "client_type_final": "ועדה", "count": 382}, {"delivery_year": 2023, "client_type_final": "ח\"כ", "count": 216}, {"delivery_year": 2023, "client_type_final": "יזומים", "count": 61}, {"delivery_year": 2023, "client_type_final": "יחידה פנימית", "count": 65}, {"delivery_year": 2024, "client_type_final": "ועדה", "count": 283}, {"delivery_year": 2024, "client_type_final": "ח\"כ", "count": 174}, {"delivery_year": 2024, "client_type_final": "יזומים", "count": 53}, {"delivery_year": 2024, "client_type_final": "יחידה פנימית", "count": 55}, {"delivery_year": 2025, "client_type_final": "ועדה", "count": 295}, {"delivery_year": 2025, "client_type_final": "ח\"כ", "count": 228}, {"delivery_year": 2025, "client_type_final": "יזומים", "count": 48}, {"delivery_year": 2025, "client_type_final": "יחידה פנימית", "count": 38}, {"delivery_year": 2026, "client_type_final": "ועדה", "count": 20}, {"delivery_year": 2026, "client_type_final": "ח\"כ", "count": 21}, {"delivery_year": 2026, "client_type_final": "יזומים", "count": 6}, {"delivery_year": 2026, "client_type_final": "יחידה פנימית", "count": 3}];
        
        const minS = document.getElementById('minS'), maxS = document.getElementById('maxS');
        const minL = document.getElementById('minL'), maxL = document.getElementById('maxL');

        function update() {
            let v1 = parseInt(minS.value), v2 = parseInt(maxS.value);
            if (v1 > v2) { if (this === minS) maxS.value = v1; else minS.value = v2; v1 = parseInt(minS.value); v2 = parseInt(maxS.value); }
            minL.innerText = v1; maxL.innerText = v2;

            const fReq = reqData.filter(d => d.year >= v1 && d.year <= v2);
            let t=0, d_count=0, p=0, c=0;
            const yearsMap = {}, clientReqMap = {};

            fReq.forEach(item => {
                t += item.count;
                if (item.status_final === 'בוצע') d_count += item.count;
                else if (item.status_final === 'בביצוע') p += item.count;
                else if (item.status_final === 'נסגר או בוטל') c += item.count;
                yearsMap[item.year] = (yearsMap[item.year] || 0) + item.count;
                clientReqMap[item.client_type_final] = (clientReqMap[item.client_type_final] || 0) + item.count;
            });

            const fDel = delData.filter(d => d.delivery_year >= v1 && d.delivery_year <= v2);
            const clientDelMap = {};
            fDel.forEach(item => {
                clientDelMap[item.client_type_final] = (clientDelMap[item.client_type_final] || 0) + item.count;
            });

            document.getElementById('kTotal').innerText = t.toLocaleString();
            document.getElementById('kDone').innerText = d_count.toLocaleString();
            document.getElementById('kPending').innerText = p.toLocaleString();
            document.getElementById('kClosed').innerText = c.toLocaleString();

            const xY = Object.keys(yearsMap).sort();
            Plotly.newPlot('barChart', [{
                x: xY, y: xY.map(y => yearsMap[y]), type: 'bar', text: xY.map(y => yearsMap[y]),
                textposition: 'inside', marker: {color: '#1a73e8'}
            }], { title: 'כמות בקשות שנתית (לפי שנת בקשה)', xaxis: {tickformat: 'd'} });

            Plotly.newPlot('pieRequests', [{
                labels: Object.keys(clientReqMap), values: Object.values(clientReqMap), 
                type: 'pie', hole: 0.5, showlegend: false,
                textinfo: 'label+value+percent', texttemplate: '%{label}<br>%{value}<br>%{percent:.1%}'
            }], { 
                title: 'התפלגות בקשות לפי סוגי לקוחות<br><span style="font-size:12px">(רק בקשות שהתקבלו בשנים ' + v1 + '-' + v2 + ')</span>'
            });

            Plotly.newPlot('pieDelivery', [{
                labels: Object.keys(clientDelMap), values: Object.values(clientDelMap), 
                type: 'pie', hole: 0.5, showlegend: false,
                textinfo: 'label+value+percent', texttemplate: '%{label}<br>%{value}<br>%{percent:.1%}'
            }], { 
                title: 'התפלגות מענים לפי סוגי לקוחות<br><span style="font-size:12px">(רק מענים שניתנו בשנים ' + v1 + '-' + v2 + ')</span>'
            });
        }

        function downloadHTML() {
            const blob = new Blob([document.documentElement.outerHTML], { type: 'text/html' });
            const a = document.createElement('a');
            a.href = window.URL.createObjectURL(blob);
            a.download = 'knesset_dashboard.html';
            a.click();
        }
        minS.oninput = update; maxS.oninput = update;
        update();
    </script>
</body>
</html>
    