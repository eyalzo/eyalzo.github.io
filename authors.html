<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title><!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
   <meta charset="UTF-8">
   <meta name="viewport" content="width=device-width, initial-scale=1.0">
   <title>Gilat AI - ××™× ×“×§×¡ ××—×‘×¨×™×</title>
   
   <link href="https://fonts.googleapis.com/css2?family=Heebo:wght@300;400;700&display=swap" rel="stylesheet">
   
   <style>
       :root {
           --primary-color: #0056b3;
           --bg-color: #f4f7f6;
           --card-bg: #ffffff;
           --text-color: #333;
           --border-color: #e0e0e0;
           --hover-bg: #e3f2fd;
           --meta-color: #555;
           
           --tag-subject-bg: #e1f5fe;
           --tag-subject-text: #0277bd;
           --tag-keyword-bg: #f5f5f5;
           --tag-keyword-text: #616161;
           --tag-keyword-hover: #e0e0e0;
       }

       body {
           font-family: 'Heebo', sans-serif;
           background-color: var(--bg-color);
           color: var(--text-color);
           margin: 0;
           padding: 20px;
           direction: rtl; text-align: right;
       }

       .container { max-width: 1000px; margin: 0 auto; }

       header {
           display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px;
       }
       h1 { color: var(--primary-color); margin: 0; }
       
       .nav-links { display: flex; gap: 10px; }
       .nav-btn {
           text-decoration: none; background-color: var(--primary-color); color: white;
           padding: 8px 16px; border-radius: 6px; font-weight: bold; transition: background 0.2s;
           font-size: 0.9em;
       }
       .nav-btn:hover { background-color: #004494; }
       .nav-btn.secondary { background-color: #546e7a; }
       .nav-btn.secondary:hover { background-color: #37474f; }

       .loader {
           border: 4px solid #f3f3f3; border-top: 4px solid var(--primary-color);
           border-radius: 50%; width: 40px; height: 40px;
           animation: spin 1s linear infinite; margin: 50px auto;
       }
       @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

       .authors-grid {
           display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 15px;
       }

       .author-card {
           background: var(--card-bg); border: 1px solid var(--border-color); border-radius: 8px;
           padding: 15px; text-decoration: none; color: var(--text-color); transition: all 0.2s;
           display: flex; flex-direction: column; justify-content: center; min-height: 80px;
           text-align: right; align-items: flex-start;
       }
       .author-card:hover {
           transform: translateY(-2px); box-shadow: 0 4px 10px rgba(0,0,0,0.1);
           border-color: var(--primary-color); background-color: var(--hover-bg);
       }
       .author-name {
           font-weight: bold; font-size: 1.1em; width: 100%;
           white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
       }

       .author-header {
           background: white; padding: 20px; border-radius: 12px; margin-bottom: 20px;
           box-shadow: 0 2px 5px rgba(0,0,0,0.05); text-align: right;
       }
       .author-header h2 { margin: 0; color: var(--primary-color); }
       .author-header p { margin: 5px 0 0; color: #666; }

       .doc-item {
           background: white; border-right: 4px solid var(--primary-color);
           padding: 20px; margin-bottom: 15px; border-radius: 8px;
           box-shadow: 0 2px 5px rgba(0,0,0,0.05); transition: transform 0.2s;
           text-align: right; direction: rtl;
       }
       .doc-item:hover { transform: translateX(-5px); }

       .doc-title {
           font-size: 1.25em; font-weight: bold; text-decoration: none;
           color: var(--primary-color); display: block; margin-bottom: 8px;
       }
       .doc-title:hover { text-decoration: underline; }

       .doc-tags {
           margin-bottom: 12px; display: flex; flex-wrap: wrap; gap: 8px; align-items: center;
       }
       .tag-badge {
           font-size: 0.85em; padding: 3px 10px; border-radius: 4px; display: inline-block;
           unicode-bidi: embed; text-decoration: none; transition: all 0.2s;
       }
       .tag-subject {
           background-color: var(--tag-subject-bg); color: var(--tag-subject-text);
           font-weight: bold; cursor: default;
       }
       .tag-keyword {
           background-color: var(--tag-keyword-bg); color: var(--tag-keyword-text);
           border: 1px solid #ddd; cursor: pointer;
       }
       .tag-keyword:hover {
           background-color: var(--tag-keyword-hover); border-color: #ccc; color: #333;
       }

       .doc-snippet {
           font-size: 0.95em; color: #444; line-height: 1.6; margin-bottom: 15px;
           background-color: #fafafa; padding: 10px; border-radius: 6px;
           unicode-bidi: embed; display: -webkit-box; -webkit-line-clamp: 3; -webkit-box-orient: vertical; overflow: hidden;
       }

       .doc-meta {
           font-size: 0.9em; color: var(--meta-color);
           display: flex; align-items: center; flex-wrap: wrap; gap: 10px;
           border-top: 1px dashed #eee; padding-top: 10px;
       }
       .meta-separator { margin: 0 5px; color: #ccc; }

       .pdf-btn {
           display: inline-flex; align-items: center; background-color: #ffebee; color: #d32f2f;
           border: 1px solid #ffcdd2; padding: 4px 10px; border-radius: 4px; text-decoration: none;
           font-weight: bold; font-size: 0.85em; margin-right: auto; 
           transition: all 0.2s;
       }
       .pdf-btn:hover { background-color: #d32f2f; color: white; border-color: #b71c1c; }
       .pdf-btn svg { width: 16px; height: 16px; margin-left: 5px; fill: currentColor; }
       
       .empty-msg { text-align: center; color: #666; margin-top: 30px; font-size: 1.2em; }
   </style>
</head>
<body>

   <div class="container">
       <header>
           <h1>ğŸ“š ××™× ×“×§×¡ ××—×‘×¨×™×</h1>
           <div class="nav-links">
               <a href="index.html" class="nav-btn secondary">×—×™×¤×•×©</a>
               <a href="stats.html" class="nav-btn secondary">×¡×˜×˜×™×¡×˜×™×§×•×ª</a>
               <a href="authors.html" class="nav-btn" id="all-authors-btn" style="display:none;">â† ×—×–×¨×” ×œ×¨×©×™××”</a>
           </div>
       </header>

       <div id="loader" class="loader"></div>

       <div id="authors-list-view" style="display:none;">
           <div class="authors-grid" id="authors-container"></div>
       </div>

       <div id="author-detail-view" style="display:none;">
           <div class="author-header">
               <h2 id="detail-author-name"></h2>
               <p>×¨×©×™××ª ××¡××›×™× ×•×¤×¨×˜×™× × ×‘×—×¨×™× (×××•×™×™×Ÿ ×œ×¤×™ ×ª××¨×™×š ××”×—×“×© ×œ×™×©×Ÿ)</p>
           </div>
           <div id="documents-container"></div>
       </div>

   </div>

   <script>
       const apiKey = "zqt_WQdPgppS5OLumkFHZXSffKRBLzOS1MmAq-c0HA";
       const corpusKey = "mmm_docs5";
       const headers = {
           "x-api-key": apiKey,
           "Accept": "application/json",
           "Content-Type": "application/json"
       };

       window.onload = function() {
           const urlParams = new URLSearchParams(window.location.search);
           const authorParam = urlParams.get('author');

           if (authorParam) {
               document.getElementById('all-authors-btn').style.display = 'inline-block';
               loadAuthorDocuments(authorParam);
           } else {
               loadAuthorsList();
           }
       };

       // --- 1. ×¨×©×™××ª ××—×‘×¨×™×: ×—×–×¨×” ×œ-doc.author ---
       async function loadAuthorsList() {
           const loader = document.getElementById('loader');
           const view = document.getElementById('authors-list-view');
           const container = document.getElementById('authors-container');

           try {
               const response = await fetch(`https://api.vectara.io/v2/corpora/${corpusKey}/filter_attribute_stats`, { headers });
               const data = await response.json();
               
               // ×—×–×¨×” ×œ×©×™××•×© ×‘×©×“×” ×”×™×©×Ÿ ×•×”×˜×•×‘ author
               const authorStats = data.filter_attribute_stats.find(s => s.name === 'doc.author');
               
               if (!authorStats || !authorStats.values || authorStats.values.length === 0) {
                   container.innerHTML = "<p class='empty-msg'>×œ× × ××¦××• × ×ª×•× ×™ ××—×‘×¨×™× (doc.author).</p>";
                   loader.style.display = 'none';
                   view.style.display = 'block';
                   return;
               }

               let authors = authorStats.values.filter(a => a.value && a.value.trim() !== "");
               authors.sort((a, b) => a.value.localeCompare(b.value, 'he'));

               authors.forEach(auth => {
                   const card = document.createElement('a');
                   card.className = 'author-card';
                   card.href = `authors.html?author=${encodeURIComponent(auth.value)}`;
                   card.innerHTML = `<div class="author-name">${auth.value}</div>`;
                   container.appendChild(card);
               });

               loader.style.display = 'none';
               view.style.display = 'block';

           } catch (e) {
               console.error(e);
               container.innerHTML = "<p class='empty-msg'>×©×’×™××” ×‘×˜×¢×™× ×ª ×”× ×ª×•× ×™×.</p>";
               loader.style.display = 'none';
               view.style.display = 'block';
           }
       }

       // --- 2. ××¡××›×™× ×©×œ ××—×‘×¨: ×—×–×¨×” ×œ×¤×™×œ×˜×¨ ×¨×’×™×œ ---
       async function loadAuthorDocuments(authorName) {
           const loader = document.getElementById('loader');
           const view = document.getElementById('author-detail-view');
           const container = document.getElementById('documents-container');
           const titleEl = document.getElementById('detail-author-name');

           titleEl.innerText = authorName;

           try {
               const safeName = authorName.replace(/'/g, "\\'");
               
               // ×©×™××•×© ×‘××•×¤×¨×˜×•×¨ ×©×•×•×” (=) ×›×™ ××“×•×‘×¨ ×‘×©×“×” ××—×¨×•×–×ª ×¨×’×™×œ (×œ× ×¨×©×™××”) ×›×¨×’×¢
               const filterString = `doc.author = '${safeName}'`;
               
               console.log("Filter used:", filterString);

               const requestData = {
                   query: "", 
                   search: {
                       corpora: [{ 
                           corpus_key: corpusKey,
                           metadata_filter: filterString
                       }],
                       offset: 0,
                       limit: 100 
                   }
               };

               const response = await fetch("https://api.vectara.io/v2/query", {
                   method: "POST",
                   headers: headers,
                   body: JSON.stringify(requestData)
               });

               const data = await response.json();
               const results = data.search_results || [];

               const uniqueDocs = new Map();

               results.forEach(res => {
                   const docId = res.document_id; 
                   
                   if (!uniqueDocs.has(docId)) {
                       const meta = res.document_metadata || {};
                       uniqueDocs.set(docId, {
                           id: docId,
                           title: meta.title || "×œ×œ× ×›×•×ª×¨×ª",
                           // ××©×ª××©×™× ×‘-ez_date ×œ×ª×¦×•×’×” ×× ×™×©, ×›×™ ×”×¡×§×¨×™×¤×˜ ×›×Ÿ ××¢×“×›×Ÿ ××•×ª×•
                           date: meta.ez_date || meta.date || "×œ× ×¦×•×™×Ÿ",
                           url: meta.url || "#",
                           author: meta.author || authorName,
                           teamleader: meta.teamleader || null,
                           snippet: res.text || "",
                           subject: meta.Subject || meta.subject || null,
                           keywords_list: meta.ez_keywords || null, 
                           keywords_str: meta.Keywords || meta.keywords || null
                       });
                   }
               });

               let docsArray = Array.from(uniqueDocs.values());
               docsArray.sort((a, b) => b.date.localeCompare(a.date));

               if (docsArray.length === 0) {
                   container.innerHTML = "<p class='empty-msg'>×œ× × ××¦××• ××¡××›×™× ×¢×‘×•×¨ ××—×‘×¨ ×–×”.</p>";
               } else {
                   const pdfIcon = `<svg class="pdf-icon" viewBox="0 0 24 24"><path d="M20 2H8c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm-8.5 7.5c0 .83-.67 1.5-1.5 1.5H9v2H7.5V7H10c.83 0 1.5.67 1.5 1.5v1zm5 2c0 .83-.67 1.5-1.5 1.5h-2.5V7H15c.83 0 1.5.67 1.5 1.5v3zm4-3H19v1h1.5V11H19v2h-1.5V7h3v1.5zM9 9.5h1v-1H9v1zM4 6H2v14c0 1.1.9 2 2 2h14v-2H4V6zm10 5.5h1v-3h-1v3z"/></svg>`;

                   docsArray.forEach(doc => {
                       const fullUrl = doc.url !== "#" ? `${doc.url}#page=1` : "#";
                       
                       let metaParts = [];
                       if (doc.date) metaParts.push(`<strong>×ª××¨×™×š:</strong> ${doc.date}`);
                       if (doc.author) metaParts.push(`<strong>××—×‘×¨/×ª:</strong> ${doc.author}`);
                       if (doc.teamleader) metaParts.push(`<strong>×¨"×¦:</strong> ${doc.teamleader}`);
                       const metaHtml = metaParts.join('<span class="meta-separator">|</span>');

                       let tagsHtml = '';
                       if (doc.subject) {
                           tagsHtml += `<span class="tag-badge tag-subject">${doc.subject}</span>`;
                       }
                       
                       let keys = [];
                       if (Array.isArray(doc.keywords_list)) {
                           keys = doc.keywords_list;
                       } else if (doc.keywords_str) {
                           keys = doc.keywords_str.replace(';', ',').split(',');
                       }

                       keys.forEach(k => {
                           const cleanKey = k.trim();
                           if(cleanKey) {
                               tagsHtml += `<a href="topics.html?topic=${encodeURIComponent(cleanKey)}" class="tag-badge tag-keyword">${cleanKey}</a>`;
                           }
                       });
                       
                       const tagsContainer = tagsHtml ? `<div class="doc-tags">${tagsHtml}</div>` : '';

                       const div = document.createElement('div');
                       div.className = 'doc-item';
                       div.innerHTML = `
                           <a href="${fullUrl}" target="_blank" class="doc-title">${doc.title}</a>
                           ${tagsContainer}
                           ${doc.snippet ? `<div class="doc-snippet">${doc.snippet}</div>` : ''}
                           <div class="doc-meta">
                               ${metaHtml}
                               ${doc.url !== "#" ? `<a href="${fullUrl}" target="_blank" class="pdf-btn">${pdfIcon} ×¤×ª×— ××¡××š</a>` : ''}
                           </div>
                       `;
                       container.appendChild(div);
                   });
               }

               loader.style.display = 'none';
               view.style.display = 'block';

           } catch (e) {
               console.error(e);
               container.innerHTML = "<p class='empty-msg'>×©×’×™××” ×‘×˜×¢×™× ×ª ×”××¡××›×™×.</p>";
               loader.style.display = 'none';
               view.style.display = 'block';
           }
       }
   </script>
</body>
</html></title>
</head>
<body>

</body>
</html>