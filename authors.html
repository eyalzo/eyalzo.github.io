<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
   <meta charset="UTF-8">
   <meta name="viewport" content="width=device-width, initial-scale=1.0">
   <title>Gilat AI - ××™× ×“×§×¡ ××—×‘×¨×™×</title>

   <link href="https://fonts.googleapis.com/css2?family=Heebo:wght@300;400;700&display=swap" rel="stylesheet">

   <style>
       :root {
           --primary-color: #0056b3;
           --bg-color: #f4f7f6;
           --card-bg: #ffffff;
           --text-color: #333;
           --border-color: #e0e0e0;
           --hover-bg: #e3f2fd;
           --meta-color: #555;

           /* ×¦×‘×¢×™× ×œ×—×•×§×¨ ×¤×¢×™×œ */
           --active-bg: #f0fdf4; /* ×™×¨×•×§ ×× ×˜×” ×‘×”×™×¨ ×××•×“ */
           --active-border: #86efac; /* ×™×¨×•×§ ×‘×”×™×¨ */
       }

       body {
           font-family: 'Heebo', sans-serif;
           background-color: var(--bg-color);
           color: var(--text-color);
           margin: 0;
           padding: 20px;
           direction: rtl; text-align: right;
       }

       .container { max-width: 1000px; margin: 0 auto; padding-bottom: 50px; }

       header {
           display: flex; flex-direction: column; margin-bottom: 30px;
       }
       .header-top {
           display: flex; justify-content: space-between; align-items: center; width: 100%;
       }
       h1 { color: var(--primary-color); margin: 0; }

       .version-tag {
           display: block; font-size: 0.45em; color: #888; font-weight: normal; margin-top: 4px; letter-spacing: 0.5px;
       }

       /* --- Header Stats Dashboard --- */
       .header-stats-row {
           margin-top: 20px; background: white; padding: 15px 20px; border-radius: 10px;
           box-shadow: 0 2px 5px rgba(0,0,0,0.05); display: flex; flex-wrap: wrap; gap: 15px; align-items: center;
           font-size: 0.9em; color: #555;
       }

       .stat-group { display: flex; align-items: center; gap: 6px; }
       .stat-label { color: #666; }
       .stat-number { font-weight: bold; color: var(--primary-color); font-size: 1.1em; }

       .stat-separator { width: 1px; height: 20px; background: #e0e0e0; margin: 0 5px; }

       /* Legend Badges in Header */
       .legend-badge {
           padding: 5px 12px; border-radius: 6px; border: 1px solid transparent;
           display: flex; align-items: center; gap: 6px; font-weight: 500;
       }
       /* ×ª×•×× ×œ×¦×‘×¢×™ ×”×›×¨×˜×™×¡×™×•×ª */
       .legend-green { background-color: #d1fae5; color: #047857; border-color: #6ee7b7; }
       .legend-yellow { background-color: #fef9c3; color: #a16207; border-color: #fde047; }
       .legend-count { font-weight: bold; font-size: 1.1em; }


       .nav-links { display: flex; gap: 10px; }
       .nav-btn {
           text-decoration: none; background-color: var(--primary-color); color: white;
           padding: 8px 16px; border-radius: 6px; font-weight: bold; transition: background 0.2s;
           font-size: 0.9em;
           cursor: pointer; border: none;
       }
       .nav-btn:hover { background-color: #004494; }
       .nav-btn.secondary { background-color: #546e7a; }
       .nav-btn.secondary:hover { background-color: #37474f; }

       /* Status & Cache Bar */
       #status-bar {
           display: flex; justify-content: space-between; align-items: center;
           background-color: #e3f2fd; color: #0d47a1;
           padding: 10px 15px; margin-bottom: 20px; border-radius: 8px; border: 1px solid #bbdefb;
           font-size: 0.9em; display: none;
       }

       .loader {
           border: 4px solid #f3f3f3; border-top: 4px solid var(--primary-color);
           border-radius: 50%; width: 40px; height: 40px;
           animation: spin 1s linear infinite; margin: 50px auto;
       }
       @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

       /* --- Grid Layout --- */
       .authors-grid {
           display: grid; grid-template-columns: repeat(auto-fill, minmax(210px, 1fr)); gap: 15px;
       }

       .author-card {
           background: var(--card-bg);
           border: 1px solid var(--border-color);
           border-radius: 8px;
           padding: 15px;
           text-decoration: none;
           color: var(--text-color);
           transition: all 0.2s;
           display: flex; flex-direction: column; justify-content: center; min-height: 100px;
           text-align: right; align-items: flex-start;
           position: relative;
       }

       .author-card.active-author {
           background-color: var(--active-bg);
           border-color: var(--active-border);
       }

       .author-card:hover {
           transform: translateY(-2px); box-shadow: 0 4px 10px rgba(0,0,0,0.1);
       }
       .author-card.active-author:hover {
           background-color: #dcfce7; border-color: #4ade80;
       }

       .author-name {
           font-weight: bold; font-size: 1.1em; width: 100%;
           white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
           margin-bottom: 8px;
       }

       .stats-row {
           display: flex; flex-wrap: wrap; gap: 6px; font-size: 0.8em; align-items: center;
           color: #666; width: 100%;
       }

       .stat-badge {
           background-color: #f1f5f9; padding: 2px 6px; border-radius: 4px; border: 1px solid #e2e8f0;
       }
       .stat-badge.count-badge { background-color: #e0f2fe; color: #0284c7; border-color: #bae6fd; font-weight: bold; }

       /* ×¦×‘×¢×™× ×œ×××•×¦×¢ (×¨×§ ×œ×¤×¢×™×œ×™×) - ×ª×•×× ×œ×›×•×ª×¨×ª */
       .stat-badge.avg-high { background-color: #d1fae5; color: #047857; border-color: #6ee7b7; font-weight: bold; } /* ×™×¨×•×§ */
       .stat-badge.avg-medium { background-color: #fef9c3; color: #a16207; border-color: #fde047; font-weight: bold; } /* ×¦×”×•×‘/×›×ª×•× */


       /* --- Top Authors Table --- */
       .top-section {
           margin-top: 50px; background: white; padding: 25px; border-radius: 12px;
           box-shadow: 0 2px 10px rgba(0,0,0,0.05); border-top: 4px solid var(--primary-color);
       }
       .top-section h2 { margin-top: 0; color: var(--primary-color); font-size: 1.4em; margin-bottom: 15px; }

       .top-table { width: 100%; border-collapse: collapse; font-size: 0.95em; }
       .top-table th { text-align: right; padding: 12px; background-color: #f8f9fa; border-bottom: 2px solid #eee; color: #555; }
       .top-table td { padding: 12px; border-bottom: 1px solid #eee; }
       .top-table tr:hover { background-color: #fcfcfc; }
       .top-table a { text-decoration: none; color: #333; font-weight: bold; }
       .top-table a:hover { color: var(--primary-color); text-decoration: underline; }
       .rank-col { color: #888; font-weight: normal; width: 30px; }


       /* Doc List Styles */
       .author-header {
           background: white; padding: 20px; border-radius: 12px; margin-bottom: 20px;
           box-shadow: 0 2px 5px rgba(0,0,0,0.05); text-align: right;
       }
       .author-header h2 { margin: 0; color: var(--primary-color); }
       .author-header p { margin: 5px 0 0; color: #666; }

       .doc-item {
           background: white; border-right: 4px solid var(--primary-color);
           padding: 20px; margin-bottom: 15px; border-radius: 8px;
           box-shadow: 0 2px 5px rgba(0,0,0,0.05); transition: transform 0.2s;
           text-align: right; direction: rtl;
       }
       .doc-item:hover { transform: translateX(-5px); }

       .doc-title {
           font-size: 1.25em; font-weight: bold; text-decoration: none;
           color: var(--primary-color); display: block; margin-bottom: 8px;
       }
       .doc-title:hover { text-decoration: underline; }

       .doc-tags { display: flex; flex-wrap: wrap; gap: 8px; align-items: center; margin: 10px 0 12px 0; }
       .tag-badge { font-size: 0.85em; padding: 3px 10px; border-radius: 4px; display: inline-block; text-decoration: none; }
       .tag-subject { background-color: var(--tag-subject-bg); color: var(--tag-subject-text); font-weight: bold; cursor: default; }
       .tag-keyword { background-color: var(--tag-keyword-bg); color: var(--tag-keyword-text); border: 1px solid #ddd; }
       .tag-keyword:hover { background-color: var(--tag-keyword-hover); border-color: #ccc; color: #333; }

       .doc-snippet {
           font-size: 0.95em; color: #444; line-height: 1.6; margin-bottom: 15px;
           background-color: #fafafa; padding: 10px; border-radius: 6px;
           display: -webkit-box; -webkit-line-clamp: 3; -webkit-box-orient: vertical; overflow: hidden;
       }

       .doc-meta { font-size: 0.9em; color: var(--meta-color); display: flex; align-items: center; flex-wrap: wrap; gap: 10px; border-top: 1px dashed #eee; padding-top: 10px; }
       .meta-separator { margin: 0 5px; color: #ccc; }

       .pdf-btn {
           display: inline-flex; align-items: center; background-color: #ffebee; color: #d32f2f;
           border: 1px solid #ffcdd2; padding: 4px 10px; border-radius: 4px; text-decoration: none;
           font-weight: bold; font-size: 0.85em; margin-right: auto; transition: all 0.2s;
       }
       .pdf-btn:hover { background-color: #d32f2f; color: white; border-color: #b71c1c; }
       .pdf-btn svg { width: 16px; height: 16px; margin-left: 5px; fill: currentColor; }

       .empty-msg { text-align: center; color: #666; margin-top: 30px; font-size: 1.2em; }
   </style>
</head>
<body>

   <div class="container">
       <header>
           <div class="header-top">
               <h1>
                   ğŸ“š ××™× ×“×§×¡ ××—×‘×¨×™×
                   <span class="version-tag">v8.0 â€¢ Smart Dashboard</span>
               </h1>
               <div class="nav-links">
                   <a href="index.html" class="nav-btn secondary">×—×™×¤×•×©</a>
                   <a href="stats.html" class="nav-btn secondary">×¡×˜×˜×™×¡×˜×™×§×•×ª</a>
                   <a href="authors.html" class="nav-btn" id="all-authors-btn" style="display:none;">â† ×—×–×¨×” ×œ×¨×©×™××”</a>
               </div>
           </div>

           <div id="header-stats-row" class="header-stats-row" style="display:none;">
               <div class="stat-group">
                   <span class="stat-label">×¡×”"×› ××—×‘×¨×™×:</span>
                   <span id="total-count" class="stat-number">0</span>
               </div>

               <div class="stat-separator"></div>

               <div class="stat-group">
                   <span class="stat-label">×¡×”"×› ×¤×¢×™×œ×™×:</span>
                   <span id="active-count" class="stat-number">0</span>
               </div>

               <div class="stat-separator"></div>

               <div class="legend-badge legend-green">
                   <span>×¤×¢×™×œ×™× ×¢× ×××•×¦×¢ ×’×‘×•×” (>7.5):</span>
                   <span id="high-avg-count" class="legend-count">0</span>
               </div>

               <div class="legend-badge legend-yellow">
                   <span>×¤×¢×™×œ×™× ×¢× ×××•×¦×¢ ×‘×™× ×•× ×™ (>3.5):</span>
                   <span id="med-avg-count" class="legend-count">0</span>
               </div>
           </div>
       </header>

       <div id="status-bar" style="display:none;">
           <span id="status-text">×˜×•×¢×Ÿ...</span>
       </div>

       <div id="loader" class="loader" style="display:none;"></div>

       <div id="authors-list-view" style="display:none;">
           <div class="authors-grid" id="authors-container"></div>

           <div class="top-section" id="top-authors-container">
               <h2>ğŸ† ××•×‘×™×œ×™× ×‘×××•×¦×¢ ×¤×¨×¡×•××™× ×©× ×ª×™</h2>
               <table class="top-table">
                   <thead>
                       <tr>
                           <th>#</th>
                           <th>×©× ×”×—×•×§×¨</th>
                           <th>×××•×¦×¢ ×œ×©× ×”</th>
                           <th>×¡×š ××¡××›×™×</th>
                           <th>×©× ×•×ª ×¤×¢×™×œ×•×ª</th>
                           <th>×¡×˜×˜×•×¡</th>
                       </tr>
                   </thead>
                   <tbody id="top-table-body"></tbody>
               </table>
           </div>
       </div>

       <div id="author-detail-view" style="display:none;">
           <div class="author-header">
               <h2 id="detail-author-name"></h2>
               <p>×¨×©×™××ª ××¡××›×™× ×•×¤×¨×˜×™× × ×‘×—×¨×™× (×××•×™×™×Ÿ ×œ×¤×™ ×ª××¨×™×š ××”×—×“×© ×œ×™×©×Ÿ)</p>
           </div>
           <div id="documents-container"></div>
       </div>

   </div>

   <script>
       const apiKey = "zqt_WQdPgppS5OLumkFHZXSffKRBLzOS1MmAq-c0HA";
       const corpusKey = "mmm_docs5";
       const headers = {
           "x-api-key": apiKey,
           "Accept": "application/json",
           "Content-Type": "application/json"
       };

       window.onload = function() {
           const urlParams = new URLSearchParams(window.location.search);
           const authorParam = urlParams.get('author');

           if (authorParam) {
               document.getElementById('all-authors-btn').style.display = 'inline-block';
               document.getElementById('header-stats-row').style.display = 'none'; // ×”×¡×ª×¨×ª ×“××©×‘×•×¨×“ ×‘×“×£ ×¤×¨×˜×™
               loadAuthorDocuments(authorParam);
           } else {
               initAuthorsList();
           }
       };

       // --- 1. ×˜×¢×™× ×ª ×¨×©×™××ª ××—×‘×¨×™× ××”×§×•×‘×¥ ×”×¡×˜×˜×™ ---
       async function initAuthorsList() {
           const container = document.getElementById('authors-container');
           const view = document.getElementById('authors-list-view');
           const loader = document.getElementById('loader');
           const statusBox = document.getElementById('status-bar');
           const statusText = document.getElementById('status-text');
           const headerStats = document.getElementById('header-stats-row');

           view.style.display = 'none';
           loader.style.display = 'block';
           statusBox.style.display = 'flex';
           statusText.innerText = "×˜×•×¢×Ÿ ××™× ×“×§×¡ ××—×‘×¨×™×...";

           try {
               const response = await fetch(`authors_data.json?t=${new Date().getTime()}`);

               if (response.ok) {
                   const data = await response.json();

                   statusBox.style.backgroundColor = "#e8f5e9";
                   statusBox.style.color = "#2e7d32";
                   statusText.innerHTML = `<b>××™× ×“×§×¡ × ×˜×¢×Ÿ ×‘×”×¦×œ×—×”</b> (×¢×•×“×›×Ÿ ×œ××—×¨×•× ×”: ${data.updated_at})`;

                   // --- ×—×™×©×•×‘ ×¡×˜×˜×™×¡×˜×™×§×•×ª ×œ×“××©×‘×•×¨×“ ---
                   const authors = data.authors;
                   const activeAuthors = authors.filter(a => a.is_active);

                   const activeCount = activeAuthors.length;
                   // ×××•×¦×¢ ×’×‘×•×” (×™×¨×•×§) >= 7.5
                   const highAvgCount = activeAuthors.filter(a => a.avg_per_year >= 7.5).length;
                   // ×××•×¦×¢ ×‘×™× ×•× ×™ (×¦×”×•×‘) >= 3.5 ×•×§×˜×Ÿ ×-7.5
                   const medAvgCount = activeAuthors.filter(a => a.avg_per_year >= 3.5 && a.avg_per_year < 7.5).length;

                   // ×¢×“×›×•×Ÿ ×”-DOM
                   document.getElementById('total-count').innerText = authors.length;
                   document.getElementById('active-count').innerText = activeCount;
                   document.getElementById('high-avg-count').innerText = highAvgCount;
                   document.getElementById('med-avg-count').innerText = medAvgCount;

                   headerStats.style.display = 'flex';

                   // ×¨×™× ×“×•×¨ ×”×’×¨×™×“
                   renderGrid(container, authors);

                   // ×¨×™× ×“×•×¨ ×”×˜×‘×œ×” ×œ××˜×” (Top 10)
                   renderTopTable(authors);

                   loader.style.display = 'none';
                   view.style.display = 'block';
               } else {
                   throw new Error("Static file missing");
               }

           } catch (e) {
               console.warn("Could not load static file.", e);
               statusText.innerText = "×§×•×‘×¥ × ×ª×•× ×™× ×—×¡×¨. × × ×œ×”×¨×™×¥ ××ª ×¡×§×¨×™×¤×˜ ×”×¢×“×›×•×Ÿ.";
               statusBox.style.backgroundColor = "#f8d7da";
               loader.style.display = 'none';
           }
       }

       // --- 2. ×¨×™× ×“×•×¨ ×”×’×¨×™×“ (×¢× ×¦×‘×¢×™× ×—×›××™×) ---
       function renderGrid(container, authorsArray) {
           const html = authorsArray.map(auth => {
               const activeClass = auth.is_active ? 'active-author' : '';

               const yearsHtml = auth.years_range
                   ? `<span class="stat-badge">${auth.years_range}</span>`
                   : '';

               // ×œ×•×’×™×§×” ×œ×¦×‘×™×¢×ª ×”×××•×¦×¢ (×¨×§ ×œ×¤×¢×™×œ×™×)
               let avgClass = '';
               if (auth.is_active && auth.avg_per_year) {
                   if (auth.avg_per_year >= 7.5) {
                       avgClass = 'avg-high'; // ×™×¨×•×§
                   } else if (auth.avg_per_year >= 3.5) {
                       avgClass = 'avg-medium'; // ×¦×”×•×‘
                   }
               }

               const avgHtml = (auth.avg_per_year !== undefined)
                   ? `<span class="stat-badge ${avgClass}" title="×××•×¦×¢ ××¡××›×™× ×œ×©× ×”">Ã˜ ${auth.avg_per_year}</span>`
                   : '';

               return `
               <a href="authors.html?author=${encodeURIComponent(auth.value)}" class="author-card ${activeClass}">
                   <div class="author-name">${auth.value}</div>

                   <div class="stats-row">
                       <span class="stat-badge count-badge">${auth.count}</span>
                       ${yearsHtml}
                       ${avgHtml}
                   </div>
               </a>
               `;
           }).join('');

           container.innerHTML = html;
       }

       // --- 3. ×¨×™× ×“×•×¨ ×˜×‘×œ×ª ×”××•×‘×™×œ×™× ---
       function renderTopTable(authors) {
           const tbody = document.getElementById('top-table-body');

           // ××™×•×Ÿ: ×§×•×“× ×œ×¤×™ ×××•×¦×¢ (×’×‘×•×” ×œ× ××•×š), ××—×¨ ×›×š ×œ×¤×™ ×›××•×ª
           const sorted = [...authors].sort((a, b) => {
               if (b.avg_per_year !== a.avg_per_year) {
                   return (b.avg_per_year || 0) - (a.avg_per_year || 0);
               }
               return b.count - a.count;
           });

           // ×œ×•×§×—×™× ××ª ×”-10 ×”×¨××©×•× ×™×
           const top10 = sorted.slice(0, 10);

           const html = top10.map((auth, index) => {
               const activeBadge = auth.is_active
                   ? '<span style="color:green; font-weight:bold;">â— ×¤×¢×™×œ</span>'
                   : '<span style="color:#ccc;">×œ× ×¤×¢×™×œ</span>';

               // ×”×“×’×©×” ×œ×××•×¦×¢ ×’×‘×•×” ×‘×˜×‘×œ×”
               const avgStyle = (auth.avg_per_year >= 7.5 && auth.is_active) ? 'color:#047857; font-weight:bold;' : '';

               return `
                   <tr>
                       <td class="rank-col">${index + 1}</td>
                       <td><a href="authors.html?author=${encodeURIComponent(auth.value)}">${auth.value}</a></td>
                       <td style="${avgStyle}">${auth.avg_per_year}</td>
                       <td>${auth.count}</td>
                       <td>${auth.years_range}</td>
                       <td>${activeBadge}</td>
                   </tr>
               `;
           }).join('');

           tbody.innerHTML = html;
       }


       // --- 4. ×˜×¢×™× ×ª ××¡××›×™× ×œ××—×‘×¨ ×‘×•×“×“ (×œ×œ× ×©×™× ×•×™) ---
       async function loadAuthorDocuments(authorName) {
           const loader = document.getElementById('loader');
           const view = document.getElementById('author-detail-view');
           const container = document.getElementById('documents-container');
           const titleEl = document.getElementById('detail-author-name');

           document.getElementById('status-bar').style.display = 'none';
           document.getElementById('authors-list-view').style.display = 'none';

           loader.style.display = 'block';
           titleEl.innerText = authorName;

           try {
               const safeName = authorName.replace(/'/g, "\\'");
               const filterString = `'${safeName}' IN doc.ez_people`;

               const requestData = {
                   query: "",
                   search: {
                       corpora: [{
                           corpus_key: corpusKey,
                           metadata_filter: filterString
                       }],
                       offset: 0,
                       limit: 100
                   }
               };

               const response = await fetch("https://api.vectara.io/v2/query", {
                   method: "POST",
                   headers: headers,
                   body: JSON.stringify(requestData)
               });

               const data = await response.json();
               const results = data.search_results || [];

               const uniqueDocs = new Map();
               results.forEach(res => {
                   const docId = res.document_id;
                   if (!uniqueDocs.has(docId)) {
                       const meta = res.document_metadata || {};
                       uniqueDocs.set(docId, {
                           id: docId,
                           title: meta.title || "×œ×œ× ×›×•×ª×¨×ª",
                           date: meta.ez_date || meta.date || "×œ× ×¦×•×™×Ÿ",
                           url: meta.url || "#",
                           author: meta.ez_people ? meta.ez_people.join(', ') : (meta.author || authorName),
                           teamleader: meta.teamleader || null,
                           snippet: res.text || "",
                           subject: meta.Subject || meta.subject || null,
                           keywords_list: meta.ez_keywords || null,
                           keywords_str: meta.Keywords || meta.keywords || null
                       });
                   }
               });

               let docsArray = Array.from(uniqueDocs.values());
               docsArray.sort((a, b) => {
                   if (a.date === "×œ× ×¦×•×™×Ÿ") return 1;
                   if (b.date === "×œ× ×¦×•×™×Ÿ") return -1;
                   return b.date.localeCompare(a.date);
               });

               if (docsArray.length === 0) {
                   container.innerHTML = "<p class='empty-msg'>×œ× × ××¦××• ××¡××›×™× ×¢×‘×•×¨ ××—×‘×¨ ×–×”.</p>";
               } else {
                   const pdfIcon = `<svg class="pdf-icon" viewBox="0 0 24 24"><path d="M20 2H8c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm-8.5 7.5c0 .83-.67 1.5-1.5 1.5H9v2H7.5V7H10c.83 0 1.5.67 1.5 1.5v1zm5 2c0 .83-.67 1.5-1.5 1.5h-2.5V7H15c.83 0 1.5.67 1.5 1.5v3zm4-3H19v1h1.5V11H19v2h-1.5V7h3v1.5zM9 9.5h1v-1H9v1zM4 6H2v14c0 1.1.9 2 2 2h14v-2H4V6zm10 5.5h1v-3h-1v3z"/></svg>`;
                   const docsHtml = docsArray.map(doc => {
                       const fullUrl = doc.url !== "#" ? `${doc.url}#page=1` : "#";
                       let metaParts = [];
                       if (doc.date) metaParts.push(`<strong>×ª××¨×™×š:</strong> ${doc.date}`);

                       let authorsHtml = doc.author;
                       if (doc.teamleader) {
                            if (authorsHtml) authorsHtml += '<span class="meta-separator">|</span>';
                            authorsHtml += `<strong>×¨"×¦:</strong> ${doc.teamleader}`;
                       }
                       if (authorsHtml) metaParts.push(authorsHtml);
                       const metaHtml = metaParts.join('<span class="meta-separator">|</span>');

                       let tagsHtml = '';
                       if (doc.subject) tagsHtml += `<span class="tag-badge tag-subject">${doc.subject}</span>`;

                       let keys = [];
                       if (Array.isArray(doc.keywords_list)) keys = doc.keywords_list;
                       else if (doc.keywords_str) keys = doc.keywords_str.replace(';', ',').split(',');

                       keys.forEach(k => {
                           const cleanKey = k.trim();
                           if(cleanKey) tagsHtml += `<a href="topics.html?topic=${encodeURIComponent(cleanKey)}" class="tag-badge tag-keyword">${cleanKey}</a>`;
                       });
                       const tagsContainer = tagsHtml ? `<div class="doc-tags">${tagsHtml}</div>` : '';
                       const snippetHtml = (doc.snippet && doc.snippet.length >= 100) ? `<div class="doc-snippet">${doc.snippet}</div>` : '';

                       return `
                           <div class="doc-item">
                               <a href="${fullUrl}" target="_blank" class="doc-title">${doc.title}</a>
                               ${tagsContainer}
                               ${snippetHtml}
                               <div class="doc-meta">
                                   ${metaHtml}
                                   ${doc.url !== "#" ? `<a href="${fullUrl}" target="_blank" class="pdf-btn">${pdfIcon} ×¤×ª×— ××¡××š</a>` : ''}
                               </div>
                           </div>
                       `;
                   }).join('');

                   container.innerHTML = docsHtml;
               }

               loader.style.display = 'none';
               view.style.display = 'block';

           } catch (e) {
               console.error(e);
               container.innerHTML = "<p class='empty-msg'>×©×’×™××” ×‘×˜×¢×™× ×ª ×”××¡××›×™×.</p>";
               loader.style.display = 'none';
               view.style.display = 'block';
           }
       }
   </script>
</body>
</html>