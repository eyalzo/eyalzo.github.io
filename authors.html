<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
   <meta charset="UTF-8">
   <meta name="viewport" content="width=device-width, initial-scale=1.0">
   <title>Gilat AI - ××™× ×“×§×¡ ××—×‘×¨×™×</title>

   <link href="https://fonts.googleapis.com/css2?family=Heebo:wght@300;400;700&display=swap" rel="stylesheet">

   <style>
       :root {
           --primary-color: #0056b3;
           --bg-color: #f4f7f6;
           --card-bg: #ffffff;
           --text-color: #333;
           --border-color: #e0e0e0;
           --hover-bg: #e3f2fd;
           --meta-color: #555;

           --active-bg: #f0fdf4;
           --active-border: #86efac;
       }

       body {
           font-family: 'Heebo', sans-serif;
           background-color: var(--bg-color);
           color: var(--text-color);
           margin: 0;
           padding: 20px;
           direction: rtl; text-align: right;
       }

       .container { max-width: 1000px; margin: 0 auto; padding-bottom: 50px; }

       header { display: flex; flex-direction: column; margin-bottom: 20px; }
       .header-top { display: flex; justify-content: space-between; align-items: center; width: 100%; }
       h1 { color: var(--primary-color); margin: 0; }

       .version-tag { display: block; font-size: 0.45em; color: #888; font-weight: normal; margin-top: 4px; letter-spacing: 0.5px; }

       /* --- Tooltip System --- */
       /* ×”××œ×× ×˜ ×©××—×–×™×§ ××ª ×”×˜×•×œ×˜×™×¤ ×—×™×™×‘ ×œ×”×™×•×ª relative */
       .has-tooltip {
           position: relative;
           cursor: help; /* ×¡××Ÿ ×©××œ×” ×§×˜×Ÿ */
       }

       /* ×¢×™×¦×•×‘ ×”×‘×•×¢×” ×¢×¦××” */
       .tooltip-content {
           visibility: hidden;
           width: 220px;
           background-color: #333;
           color: #fff;
           text-align: right;
           border-radius: 6px;
           padding: 10px;
           position: absolute;
           z-index: 100;
           bottom: 125%; /* ××•×¤×™×¢ ××¢×œ ×”××œ×× ×˜ */
           right: 50%;
           transform: translateX(50%); /* ××¨×›×•×– */
           opacity: 0;
           transition: opacity 0.3s;

           /* ×˜×§×¡×˜ ×‘×ª×•×š ×”×‘×•×¢×” */
           font-size: 0.85rem;
           font-weight: normal;
           line-height: 1.4;
           box-shadow: 0 4px 15px rgba(0,0,0,0.2);
       }

       /* ×”×—×¥ ×”×§×˜×Ÿ ×œ××˜×” */
       .tooltip-content::after {
           content: "";
           position: absolute;
           top: 100%;
           right: 50%;
           margin-right: -5px;
           border-width: 5px;
           border-style: solid;
           border-color: #333 transparent transparent transparent;
       }

       /* ×”×¦×’×” ×‘×¢×ª ×¨×™×—×•×£ */
       .has-tooltip:hover .tooltip-content {
           visibility: visible;
           opacity: 1;
       }

       /* --- Header Stats Dashboard --- */
       .header-stats-row {
           margin-top: 20px; background: white; padding: 15px 20px; border-radius: 10px;
           box-shadow: 0 2px 5px rgba(0,0,0,0.05); display: flex; flex-wrap: wrap; gap: 15px; align-items: center;
           font-size: 0.9em; color: #555;
       }

       .stat-group {
           display: flex; align-items: center; gap: 6px;
           padding: 5px 10px; border-radius: 6px; transition: background 0.2s;
       }
       .stat-group:hover { background-color: #f5f5f5; }
       .stat-group.active-filter { background-color: #e3f2fd; border: 1px solid #bbdefb; }

       .stat-label { color: #666; }
       .stat-number { font-weight: bold; color: var(--primary-color); font-size: 1.1em; }
       .stat-separator { width: 1px; height: 20px; background: #e0e0e0; margin: 0 5px; }

       .legend-badge {
           padding: 5px 12px; border-radius: 6px; border: 1px solid transparent;
           display: flex; align-items: center; gap: 6px; font-weight: 500;
           transition: transform 0.1s;
       }
       .legend-badge:hover { transform: scale(1.02); }
       .legend-badge.active-filter { box-shadow: 0 0 0 2px #333; }

       .legend-green { background-color: #d1fae5; color: #047857; border-color: #6ee7b7; }
       .legend-yellow { background-color: #fef9c3; color: #a16207; border-color: #fde047; }
       .legend-count { font-weight: bold; font-size: 1.1em; }


       /* --- Filter Status Bar --- */
       #filter-status {
           background-color: #fff3cd; color: #856404; border: 1px solid #ffeeba;
           padding: 10px; border-radius: 6px; margin-bottom: 20px;
           display: none; align-items: center; justify-content: space-between;
       }
       .clear-filter-btn {
           background: transparent; border: 1px solid #856404; color: #856404;
           padding: 2px 8px; border-radius: 4px; cursor: pointer; font-size: 0.9em;
       }
       .clear-filter-btn:hover { background: #856404; color: white; }

       /* --- Grid Layout --- */
       .authors-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(220px, 1fr)); gap: 15px; }

       .author-card {
           background: var(--card-bg); border: 1px solid var(--border-color); border-radius: 8px;
           padding: 15px; text-decoration: none; color: var(--text-color); transition: all 0.2s;
           display: flex; flex-direction: column; justify-content: center; min-height: 110px;
           text-align: right; align-items: flex-start;
           /* ×—×©×•×‘: ×›×“×™ ×©×”×‘×•×¢×” ×œ× ×ª×™×—×ª×š */
           overflow: visible;
       }
       .author-card.active-author { background-color: var(--active-bg); border-color: var(--active-border); }
       .author-card:hover { transform: translateY(-2px); box-shadow: 0 4px 10px rgba(0,0,0,0.1); }
       .author-card.active-author:hover { background-color: #dcfce7; border-color: #4ade80; }

       .author-name { font-weight: bold; font-size: 1.1em; width: 100%; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; margin-bottom: 8px; }

       .stats-row { display: flex; flex-wrap: wrap; gap: 6px; font-size: 0.8em; align-items: center; color: #666; width: 100%; overflow: visible; }

       .stat-badge { background-color: #f1f5f9; padding: 2px 6px; border-radius: 4px; border: 1px solid #e2e8f0; }
       .stat-badge.count-badge { background-color: #e0f2fe; color: #0284c7; border-color: #bae6fd; font-weight: bold; }
       .stat-badge.avg-high { background-color: #d1fae5; color: #047857; border-color: #6ee7b7; font-weight: bold; }
       .stat-badge.avg-medium { background-color: #fef9c3; color: #a16207; border-color: #fde047; font-weight: bold; }

       /* --- Top Table --- */
       .top-section { margin-top: 50px; background: white; padding: 25px; border-radius: 12px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); border-top: 4px solid var(--primary-color); }
       .top-table { width: 100%; border-collapse: collapse; font-size: 0.95em; }
       .top-table th { text-align: right; padding: 12px; background-color: #f8f9fa; border-bottom: 2px solid #eee; }
       .top-table td { padding: 12px; border-bottom: 1px solid #eee; }
       .top-table a { text-decoration: none; color: #333; font-weight: bold; }
       .rank-col { color: #888; width: 30px; }

       /* Common & Detail */
       .nav-links { display: flex; gap: 10px; }
       .nav-btn { text-decoration: none; background-color: var(--primary-color); color: white; padding: 8px 16px; border-radius: 6px; font-weight: bold; font-size: 0.9em; cursor: pointer; border: none; }
       .loader { border: 4px solid #f3f3f3; border-top: 4px solid var(--primary-color); border-radius: 50%; width: 40px; height: 40px; animation: spin 1s linear infinite; margin: 50px auto; }
       @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

       .doc-item { background: white; border-right: 4px solid var(--primary-color); padding: 20px; margin-bottom: 15px; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
       .doc-title { font-size: 1.25em; font-weight: bold; text-decoration: none; color: var(--primary-color); display: block; margin-bottom: 8px; }
       .doc-meta { font-size: 0.9em; color: var(--meta-color); display: flex; align-items: center; gap: 10px; border-top: 1px dashed #eee; padding-top: 10px; margin-top: 10px;}
       .pdf-btn { display: inline-flex; align-items: center; background-color: #ffebee; color: #d32f2f; border: 1px solid #ffcdd2; padding: 4px 10px; border-radius: 4px; text-decoration: none; font-weight: bold; font-size: 0.85em; margin-right: auto; }
   </style>
</head>
<body>

   <div class="container">
       <header>
           <div class="header-top">
               <h1>
                   ğŸ“š ××™× ×“×§×¡ ××—×‘×¨×™×
                   <span class="version-tag">v10.0 â€¢ Full Explainability</span>
               </h1>
               <div class="nav-links">
                   <a href="index.html" class="nav-btn secondary">×—×™×¤×•×©</a>
                   <a href="stats.html" class="nav-btn secondary">×¡×˜×˜×™×¡×˜×™×§×•×ª</a>
                   <a href="authors.html" class="nav-btn" id="all-authors-btn" style="display:none;">â† ×—×–×¨×” ×œ×¨×©×™××”</a>
               </div>
           </div>

           <div id="header-stats-row" class="header-stats-row" style="display:none;">
               <div class="stat-group has-tooltip" onclick="filterAuthors('all')" id="filter-all">
                   <span class="stat-label">×¡×”"×› ××—×‘×¨×™×:</span>
                   <span id="total-count" class="stat-number">0</span>
                   <span class="tooltip-content">×¡×š ×›×œ ×”××—×‘×¨×™× ×”×™×™×—×•×“×™×™× ×©××•×ª×¨×• ×‘×××’×¨ ×”××¡××›×™× (×”×™×¡×˜×•×¨×™ ×•×¤×¢×™×œ).</span>
               </div>

               <div class="stat-separator"></div>

               <div class="stat-group has-tooltip" onclick="filterAuthors('active')" id="filter-active">
                   <span class="stat-label">×¡×”"×› ×¤×¢×™×œ×™×:</span>
                   <span id="active-count" class="stat-number">0</span>
                   <span class="tooltip-content">××—×‘×¨×™× ×©×¤×¨×¡××• ×œ×¤×—×•×ª ××¡××š ××—×“ ×‘-365 ×”×™××™× ×”××—×¨×•× ×™× (×¦×‘×•×¢×™× ×‘×¨×§×¢ ×™×¨×•×§ ×‘×”×™×¨).</span>
               </div>

               <div class="stat-separator"></div>

               <div class="legend-badge legend-green has-tooltip" onclick="filterAuthors('high-avg')" id="filter-high">
                   <span>×××•×¦×¢ ×’×‘×•×” (>7.5):</span>
                   <span id="high-avg-count" class="legend-count">0</span>
                   <span class="tooltip-content"><b>×”×¦×˜×™×™× ×•×ª ×™×ª×¨×”:</b><br>×—×•×§×¨×™× ×¤×¢×™×œ×™× ×©××¤×¨×¡××™× ×‘×××•×¦×¢ ××©×•×§×œ×œ ××¢×œ 7.5 ××¡××›×™× ×‘×©× ×”.</span>
               </div>

               <div class="legend-badge legend-yellow has-tooltip" onclick="filterAuthors('med-avg')" id="filter-med">
                   <span>×××•×¦×¢ ×‘×™× ×•× ×™ (>3.5):</span>
                   <span id="med-avg-count" class="legend-count">0</span>
                   <span class="tooltip-content"><b>×§×¦×‘ ×’×‘×•×”:</b><br>×—×•×§×¨×™× ×¤×¢×™×œ×™× ×©××¤×¨×¡××™× ×‘×××•×¦×¢ ××©×•×§×œ×œ ×‘×™×Ÿ 3.5 ×œ-7.5 ××¡××›×™× ×‘×©× ×”.</span>
               </div>
           </div>
       </header>

       <div id="filter-status">
           <span id="filter-status-text"></span>
           <button class="clear-filter-btn" onclick="filterAuthors('all')">×”×¡×¨ ×¡×™× ×•×Ÿ âœ•</button>
       </div>

       <div id="loader" class="loader" style="display:none;"></div>

       <div id="authors-list-view" style="display:none;">
           <div class="authors-grid" id="authors-container"></div>

           <div class="top-section" id="top-authors-container">
               <h2>ğŸ† ××•×‘×™×œ×™× ×‘×××•×¦×¢ ××©×•×§×œ×œ ×œ×©× ×”</h2>
               <table class="top-table">
                   <thead>
                       <tr>
                           <th>#</th>
                           <th>×©× ×”×—×•×§×¨</th>
                           <th>×××•×¦×¢ (××©×•×§×œ×œ)</th>
                           <th>×¡×š ××¡××›×™×</th>
                           <th>×©× ×•×ª ×¤×¢×™×œ×•×ª</th>
                           <th>×¡×˜×˜×•×¡</th>
                       </tr>
                   </thead>
                   <tbody id="top-table-body"></tbody>
               </table>
           </div>
       </div>

       <div id="author-detail-view" style="display:none;">
           <div class="author-header">
               <h2 id="detail-author-name"></h2>
               <p>×¨×©×™××ª ××¡××›×™× ×•×¤×¨×˜×™× × ×‘×—×¨×™× (×××•×™×™×Ÿ ×œ×¤×™ ×ª××¨×™×š ××”×—×“×© ×œ×™×©×Ÿ)</p>
           </div>
           <div id="documents-container"></div>
       </div>

   </div>

   <script>
       const apiKey = "zqt_WQdPgppS5OLumkFHZXSffKRBLzOS1MmAq-c0HA";
       const corpusKey = "mmm_docs5";
       const headers = { "x-api-key": apiKey, "Accept": "application/json", "Content-Type": "application/json" };

       let allAuthorsData = [];

       window.onload = function() {
           const urlParams = new URLSearchParams(window.location.search);
           const authorParam = urlParams.get('author');

           if (authorParam) {
               document.getElementById('all-authors-btn').style.display = 'inline-block';
               document.getElementById('header-stats-row').style.display = 'none';
               loadAuthorDocuments(authorParam);
           } else {
               initAuthorsList();
           }
       };

       async function initAuthorsList() {
           const container = document.getElementById('authors-container');
           const view = document.getElementById('authors-list-view');
           const loader = document.getElementById('loader');
           const headerStats = document.getElementById('header-stats-row');

           view.style.display = 'none';
           loader.style.display = 'block';

           try {
               const response = await fetch(`authors_data.json?t=${new Date().getTime()}`);
               if (response.ok) {
                   const data = await response.json();
                   allAuthorsData = data.authors;

                   const activeAuthors = allAuthorsData.filter(a => a.is_active);
                   const highAvgCount = activeAuthors.filter(a => a.avg_per_year >= 7.5).length;
                   const medAvgCount = activeAuthors.filter(a => a.avg_per_year >= 3.5 && a.avg_per_year < 7.5).length;

                   document.getElementById('total-count').innerText = allAuthorsData.length;
                   document.getElementById('active-count').innerText = activeAuthors.length;
                   document.getElementById('high-avg-count').innerText = highAvgCount;
                   document.getElementById('med-avg-count').innerText = medAvgCount;

                   headerStats.style.display = 'flex';

                   renderGrid(container, allAuthorsData);
                   renderTopTable(allAuthorsData);

                   loader.style.display = 'none';
                   view.style.display = 'block';
               } else {
                   throw new Error("Missing file");
               }
           } catch (e) {
               console.warn(e);
               loader.style.display = 'none';
           }
       }

       function filterAuthors(type) {
           const container = document.getElementById('authors-container');
           const filterStatus = document.getElementById('filter-status');
           const filterText = document.getElementById('filter-status-text');

           document.querySelectorAll('.stat-group, .legend-badge').forEach(el => el.classList.remove('active-filter'));

           let filteredData = [];
           let label = "";

           switch(type) {
               case 'all':
                   filteredData = allAuthorsData;
                   filterStatus.style.display = 'none';
                   document.getElementById('filter-all').classList.add('active-filter');
                   break;
               case 'active':
                   filteredData = allAuthorsData.filter(a => a.is_active);
                   label = "××¦×™×’: ×—×•×§×¨×™× ×¤×¢×™×œ×™× ×‘×œ×‘×“";
                   document.getElementById('filter-active').classList.add('active-filter');
                   break;
               case 'high-avg':
                   filteredData = allAuthorsData.filter(a => a.is_active && a.avg_per_year >= 7.5);
                   label = "××¦×™×’: ×¤×¢×™×œ×™× ×¢× ×××•×¦×¢ ××©×•×§×œ×œ ×’×‘×•×” (>7.5)";
                   document.getElementById('filter-high').classList.add('active-filter');
                   break;
               case 'med-avg':
                   filteredData = allAuthorsData.filter(a => a.is_active && a.avg_per_year >= 3.5 && a.avg_per_year < 7.5);
                   label = "××¦×™×’: ×¤×¢×™×œ×™× ×¢× ×××•×¦×¢ ××©×•×§×œ×œ ×‘×™× ×•× ×™ (>3.5)";
                   document.getElementById('filter-med').classList.add('active-filter');
                   break;
           }

           if (type !== 'all') {
               filterStatus.style.display = 'flex';
               filterText.innerText = label;
           }

           renderGrid(container, filteredData);
       }

       // --- ×¨×™× ×“×•×¨ ×”×’×¨×™×“ (×¢× Tooltips) ---
       function renderGrid(container, authorsArray) {
           if (authorsArray.length === 0) {
               container.innerHTML = "<p>×œ× × ××¦××• ×ª×•×¦××•×ª ×œ×¡×™× ×•×Ÿ ×–×”.</p>";
               return;
           }

           const html = authorsArray.map(auth => {
               // 1. Tooltip for Active/Inactive
               const activeClass = auth.is_active ? 'active-author' : '';
               const activeTooltip = auth.is_active
                   ? "<b>×—×•×§×¨ ×¤×¢×™×œ:</b><br>×¤×¨×¡× ××¡××š ×‘×©× ×” ×”××—×¨×•× ×”."
                   : "<b>×—×•×§×¨ ×”×™×¡×˜×•×¨×™:</b><br>×œ× ×¤×¨×¡× ××¡××š ×‘-365 ×”×™××™× ×”××—×¨×•× ×™×.";

               // 2. Tooltip for Years
               const yearsHtml = auth.years_range
                   ? `<span class="stat-badge">${auth.years_range}</span>`
                   : '';

               // 3. Logic & Tooltip for Average
               let avgClass = '';
               let avgTooltip = "<b>×××•×¦×¢ ×©× ×ª×™ (××©×•×§×œ×œ):</b><br>×¡×š ×”× ×™×§×•×“ ×”××©×•×§×œ×œ ×—×œ×§×™ ×©× ×•×ª ×”×¤×¢×™×œ×•×ª.";

               if (auth.is_active && auth.avg_per_year) {
                   if (auth.avg_per_year >= 7.5) {
                       avgClass = 'avg-high';
                       avgTooltip += "<br><br><b style='color:#6ee7b7'>×¦×‘×¢ ×™×¨×•×§:</b> ×××•×¦×¢ ×’×‘×•×” ×‘××™×•×—×“.";
                   }
                   else if (auth.avg_per_year >= 3.5) {
                       avgClass = 'avg-medium';
                       avgTooltip += "<br><br><b style='color:#fde047'>×¦×‘×¢ ×¦×”×•×‘:</b> ×××•×¦×¢ ×‘×™× ×•× ×™-×’×‘×•×”.";
                   }
               }

               const avgHtml = (auth.avg_per_year !== undefined)
                   ? `<span class="stat-badge ${avgClass} has-tooltip" title="">
                        Ã˜ ${auth.avg_per_year}
                        <span class="tooltip-content">${avgTooltip}</span>
                      </span>`
                   : '';

               // 4. Logic & Tooltip for Weighted Count
               let countDisplay = `${auth.count}`;
               let countTooltip = "<b>×¡×¤×™×¨×” ×¨×’×™×œ×”:</b><br>××¡×¤×¨ ×”××¡××›×™× ×”×¤×™×–×™×™× ×©×”×—×•×§×¨ ×”×•×¤×™×¢ ×‘×”×.";

               if (Math.abs(auth.count - auth.weighted_count) > 0.1) {
                   countDisplay = `${auth.count} <span style="font-weight:normal; font-size:0.9em">(${auth.weighted_count})</span>`;
                   countTooltip += `<br><br><b>×”××¡×¤×¨ ×‘×¡×•×’×¨×™×™× (${auth.weighted_count}):</b><br>×¡×¤×™×¨×” ××©×•×§×œ×œ×ª. ××—×‘×¨ ×™×—×™×“ ××§×‘×œ × ×§×•×“×” ××œ××”, ××—×‘×¨ ×‘×¦×•×•×ª ××§×‘×œ ×—×œ×§ ×™×—×¡×™ (×œ××©×œ 1/3).`;
               }

               return `
               <div style="position:relative;">
                   <a href="authors.html?author=${encodeURIComponent(auth.value)}" class="author-card ${activeClass} has-tooltip">
                       <div class="author-name">${auth.value}</div>
                       <span class="tooltip-content" style="bottom:100%; right:0; transform:none;">${activeTooltip}</span>

                       <div class="stats-row">
                           <span class="stat-badge count-badge has-tooltip">
                               ${countDisplay}
                               <span class="tooltip-content">${countTooltip}</span>
                           </span>

                           ${yearsHtml}
                           ${avgHtml}
                       </div>
                   </a>
               </div>
               `;
           }).join('');

           container.innerHTML = html;
       }

       function renderTopTable(authors) {
           const tbody = document.getElementById('top-table-body');
           const sorted = [...authors].sort((a, b) => (b.avg_per_year || 0) - (a.avg_per_year || 0));
           const top10 = sorted.slice(0, 10);

           const html = top10.map((auth, index) => {
               const activeBadge = auth.is_active
                   ? '<span style="color:green; font-weight:bold;">â— ×¤×¢×™×œ</span>'
                   : '<span style="color:#ccc;">×œ× ×¤×¢×™×œ</span>';

               const avgStyle = (auth.avg_per_year >= 7.5 && auth.is_active) ? 'color:#047857; font-weight:bold;' : '';

               return `
                   <tr>
                       <td class="rank-col">${index + 1}</td>
                       <td><a href="authors.html?author=${encodeURIComponent(auth.value)}">${auth.value}</a></td>
                       <td style="${avgStyle}">${auth.avg_per_year}</td>
                       <td>${auth.count} <span style="font-size:0.8em; color:#888">(${auth.weighted_count})</span></td>
                       <td>${auth.years_range}</td>
                       <td>${activeBadge}</td>
                   </tr>
               `;
           }).join('');

           tbody.innerHTML = html;
       }

       async function loadAuthorDocuments(authorName) {
           const loader = document.getElementById('loader');
           const view = document.getElementById('author-detail-view');
           const container = document.getElementById('documents-container');
           const titleEl = document.getElementById('detail-author-name');

           document.getElementById('authors-list-view').style.display = 'none';
           loader.style.display = 'block';
           titleEl.innerText = authorName;

           try {
               const safeName = authorName.replace(/'/g, "\\'");
               const filterString = `'${safeName}' IN doc.ez_people`;

               const requestData = {
                   query: "",
                   search: {
                       corpora: [{ corpus_key: corpusKey, metadata_filter: filterString }],
                       offset: 0, limit: 100
                   }
               };

               const response = await fetch("https://api.vectara.io/v2/query", {
                   method: "POST", headers: headers, body: JSON.stringify(requestData)
               });
               const data = await response.json();
               const results = data.search_results || [];

               const uniqueDocs = new Map();
               results.forEach(res => {
                   const docId = res.document_id;
                   if (!uniqueDocs.has(docId)) {
                       const meta = res.document_metadata || {};
                       uniqueDocs.set(docId, {
                           id: docId,
                           title: meta.title || "×œ×œ× ×›×•×ª×¨×ª",
                           date: meta.ez_date || meta.date || "×œ× ×¦×•×™×Ÿ",
                           url: meta.url || "#",
                           author: meta.ez_people ? meta.ez_people.join(', ') : (meta.author || authorName),
                           teamleader: meta.teamleader || null,
                           snippet: res.text || "",
                           subject: meta.Subject || meta.subject || null,
                           keywords_list: meta.ez_keywords || null,
                           keywords_str: meta.Keywords || meta.keywords || null
                       });
                   }
               });

               let docsArray = Array.from(uniqueDocs.values());
               docsArray.sort((a, b) => {
                   if (a.date === "×œ× ×¦×•×™×Ÿ") return 1;
                   if (b.date === "×œ× ×¦×•×™×Ÿ") return -1;
                   return b.date.localeCompare(a.date);
               });

               if (docsArray.length === 0) {
                   container.innerHTML = "<p class='empty-msg'>×œ× × ××¦××• ××¡××›×™× ×¢×‘×•×¨ ××—×‘×¨ ×–×”.</p>";
               } else {
                   const pdfIcon = `<svg class="pdf-icon" viewBox="0 0 24 24"><path d="M20 2H8c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm-8.5 7.5c0 .83-.67 1.5-1.5 1.5H9v2H7.5V7H10c.83 0 1.5.67 1.5 1.5v1zm5 2c0 .83-.67 1.5-1.5 1.5h-2.5V7H15c.83 0 1.5.67 1.5 1.5v3zm4-3H19v1h1.5V11H19v2h-1.5V7h3v1.5zM9 9.5h1v-1H9v1zM4 6H2v14c0 1.1.9 2 2 2h14v-2H4V6zm10 5.5h1v-3h-1v3z"/></svg>`;
                   const docsHtml = docsArray.map(doc => {
                       const fullUrl = doc.url !== "#" ? `${doc.url}#page=1` : "#";
                       let metaParts = [];
                       if (doc.date) metaParts.push(`<strong>×ª××¨×™×š:</strong> ${doc.date}`);

                       let authorsHtml = doc.author;
                       if (doc.teamleader) {
                            if (authorsHtml) authorsHtml += '<span class="meta-separator">|</span>';
                            authorsHtml += `<strong>×¨"×¦:</strong> ${doc.teamleader}`;
                       }
                       if (authorsHtml) metaParts.push(authorsHtml);
                       const metaHtml = metaParts.join('<span class="meta-separator">|</span>');

                       let tagsHtml = '';
                       if (doc.subject) tagsHtml += `<span class="tag-badge tag-subject">${doc.subject}</span>`;

                       let keys = [];
                       if (Array.isArray(doc.keywords_list)) keys = doc.keywords_list;
                       else if (doc.keywords_str) keys = doc.keywords_str.replace(';', ',').split(',');

                       keys.forEach(k => {
                           const cleanKey = k.trim();
                           if(cleanKey) tagsHtml += `<a href="topics.html?topic=${encodeURIComponent(cleanKey)}" class="tag-badge tag-keyword">${cleanKey}</a>`;
                       });
                       const tagsContainer = tagsHtml ? `<div class="doc-tags">${tagsHtml}</div>` : '';
                       const snippetHtml = (doc.snippet && doc.snippet.length >= 100) ? `<div class="doc-snippet">${doc.snippet}</div>` : '';

                       return `
                           <div class="doc-item">
                               <a href="${fullUrl}" target="_blank" class="doc-title">${doc.title}</a>
                               ${tagsContainer}
                               ${snippetHtml}
                               <div class="doc-meta">
                                   ${metaHtml}
                                   ${doc.url !== "#" ? `<a href="${fullUrl}" target="_blank" class="pdf-btn">${pdfIcon} ×¤×ª×— ××¡××š</a>` : ''}
                               </div>
                           </div>
                       `;
                   }).join('');

                   container.innerHTML = docsHtml;
               }

               loader.style.display = 'none';
               view.style.display = 'block';

           } catch (e) {
               console.error(e);
               loader.style.display = 'none';
           }
       }
   </script>
</body>
</html>